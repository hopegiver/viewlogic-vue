var p=class{constructor(e,t={}){this.config={enabled:t.useI18n!==void 0?t.useI18n:!0,defaultLanguage:t.defaultLanguage||"ko",fallbackLanguage:t.defaultLanguage||"ko",cacheKey:t.cacheKey||"viewlogic_lang",dataCacheKey:t.dataCacheKey||"viewlogic_i18n_data",cacheVersion:t.cacheVersion||"1.0.0",enableDataCache:t.enableDataCache!==!1,debug:t.debug||!1},this.router=e,this.messages=new Map,this.currentLanguage=this.config.defaultLanguage,this.isLoading=!1,this.loadPromises=new Map,this.listeners={languageChanged:[]},this.initPromise=this.init()}async init(){if(!this.config.enabled){this.log("info","I18n system disabled");return}if(this.loadLanguageFromCache(),this.config.debug&&(this.config.enableDataCache=!1,this.log("debug","Data cache disabled in debug mode")),this.messages.has(this.currentLanguage))this.log("debug","Language messages already loaded:",this.currentLanguage);else try{await this.loadMessages(this.currentLanguage)}catch(e){this.log("error","Failed to load initial language file:",e)}}loadLanguageFromCache(){try{let e=localStorage.getItem(this.config.cacheKey);e&&this.isValidLanguage(e)&&(this.currentLanguage=e,this.log("debug","Language loaded from cache:",e))}catch(e){this.log("warn","Failed to load language from cache:",e)}}isValidLanguage(e){return typeof e=="string"&&/^[a-z]{2}$/.test(e)}getCurrentLanguage(){return this.currentLanguage}async setLanguage(e){if(!this.isValidLanguage(e))return this.log("warn","Invalid language code:",e),!1;if(this.currentLanguage===e)return this.log("debug","Language already set to:",e),!0;let t=this.currentLanguage;this.currentLanguage=e;try{return await this.loadMessages(e),this.saveLanguageToCache(e),this.emit("languageChanged",{from:t,to:e,messages:this.messages.get(e)}),this.log("info","Language changed successfully",{from:t,to:e}),!0}catch(r){return this.currentLanguage=t,this.log("error","Failed to change language:",r),!1}}saveLanguageToCache(e){try{localStorage.setItem(this.config.cacheKey,e),this.log("debug","Language saved to cache:",e)}catch(t){this.log("warn","Failed to save language to cache:",t)}}async loadMessages(e){if(this.messages.has(e))return this.log("debug","Messages already loaded for:",e),this.messages.get(e);if(this.loadPromises.has(e))return this.log("debug","Messages loading in progress for:",e),await this.loadPromises.get(e);let t=this._loadMessagesFromFile(e);this.loadPromises.set(e,t);try{let r=await t;return this.messages.set(e,r),this.loadPromises.delete(e),this.log("debug","Messages loaded successfully for:",e),r}catch(r){throw this.loadPromises.delete(e),r}}async _loadMessagesFromFile(e){if(this.config.enableDataCache){let t=this.getDataFromCache(e);if(t)return this.log("debug","Messages loaded from cache:",e),t}try{let t=await fetch(`../i18n/${e}.json`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let r=await t.json();return this.config.enableDataCache&&this.saveDataToCache(e,r),r}catch(t){if(this.log("error","Failed to load messages file for:",e,t),e!==this.config.fallbackLanguage)return this.log("info","Trying fallback language:",this.config.fallbackLanguage),await this._loadMessagesFromFile(this.config.fallbackLanguage);throw new Error(`Failed to load messages for language: ${e}`)}}getDataFromCache(e){try{let t=`${this.config.dataCacheKey}_${e}_${this.config.cacheVersion}`,r=localStorage.getItem(t);if(r){let{data:a,timestamp:o,version:i}=JSON.parse(r);if(i!==this.config.cacheVersion)return this.log("debug","Cache version mismatch, clearing:",e),localStorage.removeItem(t),null;let n=Date.now(),c=1440*60*1e3;return n-o>c?(this.log("debug","Cache expired, removing:",e),localStorage.removeItem(t),null):a}}catch(t){this.log("warn","Failed to read from cache:",t)}return null}saveDataToCache(e,t){try{let r=`${this.config.dataCacheKey}_${e}_${this.config.cacheVersion}`,a={data:t,timestamp:Date.now(),version:this.config.cacheVersion};localStorage.setItem(r,JSON.stringify(a)),this.log("debug","Data saved to cache:",e)}catch(r){this.log("warn","Failed to save to cache:",r)}}t(e,t={}){if(!this.config.enabled)return e;let r=this.messages.get(this.currentLanguage);if(!r)return this.log("warn","No messages loaded for current language:",this.currentLanguage),e;let a=this.getNestedValue(r,e);if(a===void 0){this.log("warn","Translation not found for key:",e);let o=this.messages.get(this.config.fallbackLanguage);if(o&&this.currentLanguage!==this.config.fallbackLanguage){let i=this.getNestedValue(o,e);if(i!==void 0)return this.interpolate(i,t)}return e}return this.interpolate(a,t)}getNestedValue(e,t){return t.split(".").reduce((r,a)=>r&&r[a]!==void 0?r[a]:void 0,e)}interpolate(e,t){return typeof e!="string"?e:e.replace(/\{(\w+)\}/g,(r,a)=>t.hasOwnProperty(a)?t[a]:r)}plural(e,t,r={}){let a=t===1?`${e}.singular`:`${e}.plural`;return this.t(a,{...r,count:t})}getAvailableLanguages(){return["ko","en"]}on(e,t){this.listeners[e]&&this.listeners[e].push(t)}off(e,t){if(this.listeners[e]){let r=this.listeners[e].indexOf(t);r>-1&&this.listeners[e].splice(r,1)}}emit(e,t){this.listeners[e]&&this.listeners[e].forEach(r=>{try{r(t)}catch(a){this.log("error","Error in event listener:",a)}})}getMessages(){return this.messages.get(this.currentLanguage)||{}}formatDate(e,t={}){let r=this.currentLanguage==="ko"?"ko-KR":"en-US";return new Intl.DateTimeFormat(r,t).format(new Date(e))}formatNumber(e,t={}){let r=this.currentLanguage==="ko"?"ko-KR":"en-US";return new Intl.NumberFormat(r,t).format(e)}log(e,...t){var r;(r=this.router)!=null&&r.errorHandler&&this.router.errorHandler.log(e,"I18nManager",...t)}isEnabled(){return this.config.enabled}async isReady(){if(!this.config.enabled)return!0;try{return await this.initPromise,!0}catch(e){return this.log("error","I18n initialization failed:",e),!1}}clearCache(){try{let t=Object.keys(localStorage).filter(r=>r.startsWith(this.config.dataCacheKey));t.forEach(r=>{localStorage.removeItem(r)}),this.log("debug","Cache cleared, removed",t.length,"items")}catch(e){this.log("warn","Failed to clear cache:",e)}}getCacheInfo(){let e={enabled:this.config.enableDataCache,version:this.config.cacheVersion,languages:{}};try{Object.keys(localStorage).filter(a=>a.startsWith(this.config.dataCacheKey)).forEach(a=>{let o=a.match(new RegExp(`${this.config.dataCacheKey}_(w+)_(.+)`));if(o){let[,i,n]=o,c=JSON.parse(localStorage.getItem(a));e.languages[i]={version:n,timestamp:c.timestamp,age:Date.now()-c.timestamp}}})}catch(t){this.log("warn","Failed to get cache info:",t)}return e}async initialize(){if(!this.config.enabled)return this.log("info","I18n system is disabled, skipping initialization"),!0;try{return await this.initPromise,this.log("info","I18n system fully initialized"),!0}catch(e){return this.log("error","Failed to initialize I18n system:",e),!1}}};var y=class{constructor(e,t={}){this.config={enabled:t.authEnabled||!1,loginRoute:t.loginRoute||"login",protectedRoutes:t.protectedRoutes||[],protectedPrefixes:t.protectedPrefixes||[],publicRoutes:t.publicRoutes||["login","register","home"],checkAuthFunction:t.checkAuthFunction||null,redirectAfterLogin:t.redirectAfterLogin||"home",authCookieName:t.authCookieName||"authToken",authFallbackCookieNames:t.authFallbackCookieNames||["accessToken","token","jwt"],authStorage:t.authStorage||"cookie",authCookieOptions:t.authCookieOptions||{},authSkipValidation:t.authSkipValidation||!1,debug:t.debug||!1},this.router=e,this.eventListeners=new Map,this.log("info","AuthManager initialized",{enabled:this.config.enabled})}log(e,...t){var r;(r=this.router)!=null&&r.errorHandler&&this.router.errorHandler.log(e,"AuthManager",...t)}async checkAuthentication(e){if(!this.config.enabled)return{allowed:!0,reason:"auth_disabled"};if(this.log("debug",`\u{1F510} Checking authentication for route: ${e}`),this.isPublicRoute(e))return{allowed:!0,reason:"public_route"};if(!this.isProtectedRoute(e))return{allowed:!0,reason:"not_protected"};if(typeof this.config.checkAuthFunction=="function")try{let a=await this.config.checkAuthFunction(e);return{allowed:a,reason:a?"custom_auth_success":"custom_auth_failed",routeName:e}}catch(a){return this.log("error","Custom auth function failed:",a),{allowed:!1,reason:"custom_auth_error",error:a}}let r=this.isUserAuthenticated();return{allowed:r,reason:r?"authenticated":"not_authenticated",routeName:e}}isUserAuthenticated(){this.log("debug","\u{1F50D} Checking user authentication status");let e=localStorage.getItem("authToken")||localStorage.getItem("accessToken");if(e)try{if(e.includes(".")){let a=JSON.parse(atob(e.split(".")[1]));if(a.exp&&Date.now()>=a.exp*1e3)return this.log("debug","localStorage token expired, removing..."),localStorage.removeItem("authToken"),localStorage.removeItem("accessToken"),!1}return this.log("debug","\u2705 Valid token found in localStorage"),!0}catch(a){this.log("warn","Invalid token in localStorage:",a)}if(sessionStorage.getItem("authToken")||sessionStorage.getItem("accessToken"))return this.log("debug","\u2705 Token found in sessionStorage"),!0;let r=this.getAuthCookie();if(r)try{if(r.includes(".")){let a=JSON.parse(atob(r.split(".")[1]));if(a.exp&&Date.now()>=a.exp*1e3)return this.log("debug","Cookie token expired, removing..."),this.removeAuthCookie(),!1}return this.log("debug","\u2705 Valid token found in cookies"),!0}catch(a){this.log("warn","Cookie token validation failed:",a)}return window.user||window.isAuthenticated?(this.log("debug","\u2705 Global authentication variable found"),!0):(this.log("debug","\u274C No valid authentication found"),!1)}isPublicRoute(e){return this.config.publicRoutes.includes(e)}isProtectedRoute(e){if(this.config.protectedRoutes.includes(e))return!0;for(let t of this.config.protectedPrefixes)if(e.startsWith(t))return!0;return!1}getAuthCookie(){let e=this.getCookieValue(this.config.authCookieName);if(e)return e;for(let t of this.config.authFallbackCookieNames){let r=this.getCookieValue(t);if(r)return this.log("debug",`Found auth token in fallback cookie: ${t}`),r}return null}getCookieValue(e){let r=`; ${document.cookie}`.split(`; ${e}=`);return r.length===2?decodeURIComponent(r.pop().split(";").shift()):null}removeAuthCookie(){[this.config.authCookieName,...this.config.authFallbackCookieNames].forEach(t=>{document.cookie=`${t}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`,document.cookie=`${t}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${window.location.pathname};`}),this.log("debug","Auth cookies removed")}getAccessToken(){let e=localStorage.getItem("authToken")||localStorage.getItem("accessToken");return e||(e=sessionStorage.getItem("authToken")||sessionStorage.getItem("accessToken"),e)||(e=this.getAuthCookie(),e)?e:null}setAccessToken(e,t={}){if(!e)return this.log("warn","Empty token provided"),!1;let{storage:r=this.config.authStorage,cookieOptions:a=this.config.authCookieOptions,skipValidation:o=this.config.authSkipValidation}=t;try{if(!o&&e.includes("."))try{let i=JSON.parse(atob(e.split(".")[1]));if(i.exp&&Date.now()>=i.exp*1e3)return this.log("warn","\u274C Token is expired"),!1;this.log("debug","\u2705 JWT token validated")}catch(i){this.log("warn","\u26A0\uFE0F JWT validation failed, but proceeding:",i.message)}switch(r){case"localStorage":localStorage.setItem("authToken",e),this.log("debug","Token saved to localStorage");break;case"sessionStorage":sessionStorage.setItem("authToken",e),this.log("debug","Token saved to sessionStorage");break;case"cookie":this.setAuthCookie(e,a);break;default:localStorage.setItem("authToken",e),this.log("debug","Token saved to localStorage (default)")}return this.emitAuthEvent("token_set",{storage:r,tokenLength:e.length,hasExpiration:e.includes(".")}),!0}catch(i){return this.log("Failed to set token:",i),!1}}setAuthCookie(e,t={}){let{cookieName:r=this.config.authCookieName,secure:a=window.location.protocol==="https:",sameSite:o="Strict",path:i="/",domain:n=null}=t,c=`${r}=${encodeURIComponent(e)}; path=${i}`;a&&(c+="; Secure"),o&&(c+=`; SameSite=${o}`),n&&(c+=`; Domain=${n}`);try{if(e.includes("."))try{let l=JSON.parse(atob(e.split(".")[1]));if(l.exp){let h=new Date(l.exp*1e3);c+=`; Expires=${h.toUTCString()}`}}catch(l){this.log("Could not extract expiration from JWT token")}}catch(l){this.log("Token processing error:",l)}document.cookie=c,this.log(`Auth cookie set: ${r}`)}removeAccessToken(e="all"){switch(e){case"localStorage":localStorage.removeItem("authToken"),localStorage.removeItem("accessToken");break;case"sessionStorage":sessionStorage.removeItem("authToken"),sessionStorage.removeItem("accessToken");break;case"cookie":this.removeAuthCookie();break;case"all":default:localStorage.removeItem("authToken"),localStorage.removeItem("accessToken"),sessionStorage.removeItem("authToken"),sessionStorage.removeItem("accessToken"),this.removeAuthCookie();break}this.emitAuthEvent("token_removed",{storage:e}),this.log(`Token removed from: ${e}`)}handleLoginSuccess(e=null){let t=e||this.config.redirectAfterLogin;return this.log(`\u{1F389} Login success, redirecting to: ${t}`),this.emitAuthEvent("login_success",{targetRoute:t}),this.router&&typeof this.router.navigateTo=="function"&&this.router.navigateTo(t),t}handleLogout(){return this.log("\u{1F44B} Logging out user"),this.removeAccessToken(),window.user&&(window.user=null),window.isAuthenticated&&(window.isAuthenticated=!1),this.emitAuthEvent("logout",{}),this.router&&typeof this.router.navigateTo=="function"&&this.router.navigateTo(this.config.loginRoute),this.config.loginRoute}emitAuthEvent(e,t){let r=new CustomEvent("router:auth",{detail:{type:e,timestamp:Date.now(),...t}});document.dispatchEvent(r),this.eventListeners.has(e)&&this.eventListeners.get(e).forEach(a=>{try{a(t)}catch(o){this.log("Event listener error:",o)}}),this.log(`\u{1F514} Auth event emitted: ${e}`,t)}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}off(e,t){if(this.eventListeners.has(e)){let r=this.eventListeners.get(e),a=r.indexOf(t);a>-1&&r.splice(a,1)}}getAuthStats(){return{enabled:this.config.enabled,isAuthenticated:this.isUserAuthenticated(),hasToken:!!this.getAccessToken(),protectedRoutesCount:this.config.protectedRoutes.length,protectedPrefixesCount:this.config.protectedPrefixes.length,publicRoutesCount:this.config.publicRoutes.length,storage:this.config.authStorage,loginRoute:this.config.loginRoute}}destroy(){this.eventListeners.clear(),this.log("debug","AuthManager destroyed")}};var b=class{constructor(e,t={}){this.config={cacheMode:t.cacheMode||"memory",cacheTTL:t.cacheTTL||3e5,maxCacheSize:t.maxCacheSize||50,debug:t.debug||!1},this.router=e,this.cache=new Map,this.cacheTimestamps=new Map,this.lruOrder=[],this.log("info","CacheManager initialized with config:",this.config)}log(e,...t){var r;(r=this.router)!=null&&r.errorHandler&&this.router.errorHandler.log(e,"CacheManager",...t)}setCache(e,t){let r=Date.now();if(this.config.cacheMode==="lru"){if(this.cache.size>=this.config.maxCacheSize&&!this.cache.has(e)){let o=this.lruOrder.shift();o&&(this.cache.delete(o),this.cacheTimestamps.delete(o),this.log("debug",`\u{1F5D1}\uFE0F LRU evicted cache key: ${o}`))}let a=this.lruOrder.indexOf(e);a>-1&&this.lruOrder.splice(a,1),this.lruOrder.push(e)}this.cache.set(e,t),this.cacheTimestamps.set(e,r),this.log("debug",`\u{1F4BE} Cached: ${e} (size: ${this.cache.size})`)}getFromCache(e){let t=Date.now(),r=this.cacheTimestamps.get(e);if(r&&t-r>this.config.cacheTTL){if(this.cache.delete(e),this.cacheTimestamps.delete(e),this.config.cacheMode==="lru"){let o=this.lruOrder.indexOf(e);o>-1&&this.lruOrder.splice(o,1)}return this.log("debug",`\u23F0 Cache expired and removed: ${e}`),null}let a=this.cache.get(e);if(a&&this.config.cacheMode==="lru"){let o=this.lruOrder.indexOf(e);o>-1&&(this.lruOrder.splice(o,1),this.lruOrder.push(e))}return a?this.log("debug",`\u{1F3AF} Cache hit: ${e}`):this.log("debug",`\u274C Cache miss: ${e}`),a}hasCache(e){return this.cache.has(e)&&this.getFromCache(e)!==null}invalidateByPattern(e){let t=[];for(let r of this.cache.keys())(r.includes(e)||r.startsWith(e))&&t.push(r);return t.forEach(r=>{if(this.cache.delete(r),this.cacheTimestamps.delete(r),this.config.cacheMode==="lru"){let a=this.lruOrder.indexOf(r);a>-1&&this.lruOrder.splice(a,1)}}),this.log("debug",`\u{1F9F9} Invalidated ${t.length} cache entries matching: ${e}`),t.length}invalidateComponentCache(e){let t=[`component_${e}`,`script_${e}`,`template_${e}`,`style_${e}`,`layout_${e}`],r=0;return t.forEach(a=>{r+=this.invalidateByPattern(a)}),this.log(`\u{1F504} Invalidated component cache for route: ${e} (${r} entries)`),r}clearComponentCache(){let e=["component_","script_","template_","style_","layout_"],t=0;return e.forEach(r=>{t+=this.invalidateByPattern(r)}),this.log(`\u{1F9FD} Cleared all component caches (${t} entries)`),t}clearCache(){let e=this.cache.size;this.cache.clear(),this.cacheTimestamps.clear(),this.lruOrder=[],this.log(`\u{1F525} Cleared all cache (${e} entries)`)}cleanExpiredCache(){let e=Date.now(),t=[];for(let[r,a]of this.cacheTimestamps.entries())e-a>this.config.cacheTTL&&t.push(r);return t.forEach(r=>{if(this.cache.delete(r),this.cacheTimestamps.delete(r),this.config.cacheMode==="lru"){let a=this.lruOrder.indexOf(r);a>-1&&this.lruOrder.splice(a,1)}}),t.length>0&&this.log(`\u23F1\uFE0F Cleaned ${t.length} expired cache entries`),t.length}getCacheStats(){return{size:this.cache.size,maxSize:this.config.maxCacheSize,mode:this.config.cacheMode,ttl:this.config.cacheTTL,memoryUsage:this.getMemoryUsage(),hitRatio:this.getHitRatio(),categories:this.getCategorizedStats()}}getMemoryUsage(){let e=0;for(let[t,r]of this.cache.entries())e+=t.length*2,typeof r=="string"?e+=r.length*2:typeof r=="object"&&r!==null?e+=JSON.stringify(r).length*2:e+=8;return{bytes:e,kb:Math.round(e/1024*100)/100,mb:Math.round(e/(1024*1024)*100)/100}}getHitRatio(){let e=this.cache.size>0?Math.min(this.cache.size/this.config.maxCacheSize,1):0;return Math.round(e*100)}getCategorizedStats(){let e={components:0,scripts:0,templates:0,styles:0,layouts:0,others:0};for(let t of this.cache.keys())t.startsWith("component_")?e.components++:t.startsWith("script_")?e.scripts++:t.startsWith("template_")?e.templates++:t.startsWith("style_")?e.styles++:t.startsWith("layout_")?e.layouts++:e.others++;return e}getCacheKeys(){return Array.from(this.cache.keys())}getCacheKeysByPattern(e){return this.getCacheKeys().filter(t=>t.includes(e)||t.startsWith(e))}startAutoCleanup(e=6e4){this.cleanupInterval&&clearInterval(this.cleanupInterval),this.cleanupInterval=setInterval(()=>{this.cleanExpiredCache()},e),this.log(`\u{1F916} Auto cleanup started (interval: ${e}ms)`)}stopAutoCleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null,this.log("debug","\u{1F6D1} Auto cleanup stopped"))}destroy(){this.stopAutoCleanup(),this.clearCache(),this.log("debug","CacheManager destroyed")}};var w=class{constructor(e,t={}){this.config={enableParameterValidation:t.enableParameterValidation!==!1,logSecurityWarnings:t.logSecurityWarnings!==!1,maxParameterLength:t.maxParameterLength||1e3,maxArraySize:t.maxArraySize||100,maxParameterCount:t.maxParameterCount||50,allowedKeyPattern:t.allowedKeyPattern||/^[a-zA-Z0-9_\-]+$/,debug:t.debug||!1},this.router=e,this.currentQueryParams={},this.log("info","QueryManager initialized with config:",this.config)}log(e,...t){var r;(r=this.router)!=null&&r.errorHandler&&this.router.errorHandler.log(e,"QueryManager",...t)}sanitizeParameter(e){if(typeof e!="string")return e;let t=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/<object\b[^<]*(?:(?!<\/object>)<[^<]*)*<\/object>/gi,"").replace(/<embed\b[^<]*(?:(?!<\/embed>)<[^<]*)*<\/embed>/gi,"").replace(/<link\b[^<]*>/gi,"").replace(/<meta\b[^<]*>/gi,"").replace(/javascript:/gi,"").replace(/vbscript:/gi,"").replace(/data:/gi,"").replace(/on\w+\s*=/gi,"").replace(/expression\s*\(/gi,"").replace(/url\s*\(/gi,""),r=[/(\b(union|select|insert|update|delete|drop|create|alter|exec|execute|sp_|xp_)\b)/gi,/(;|\||&|\*|%|<|>)/g,/(--|\/\*|\*\/)/g,/(\bor\b.*\b=\b|\band\b.*\b=\b)/gi,/('.*'|".*")/g,/(\\\w+)/g];for(let a of r)t=t.replace(a,"");return t=t.replace(/[<>'"&]{2,}/g,""),t.length>this.config.maxParameterLength&&(t=t.substring(0,this.config.maxParameterLength)),t.trim()}validateParameter(e,t){if(!this.config.enableParameterValidation)return!0;if(typeof e!="string"||e.length===0)return!1;if(!this.config.allowedKeyPattern.test(e))return this.config.logSecurityWarnings&&console.warn(`Invalid parameter key format: ${e}`),!1;if(e.length>50)return this.config.logSecurityWarnings&&console.warn(`Parameter key too long: ${e}`),!1;if(t!=null){if(typeof t=="string"){if(t.length>this.config.maxParameterLength)return this.config.logSecurityWarnings&&console.warn(`Parameter value too long for key: ${e}`),!1;let r=[/<script|<iframe|<object|<embed/gi,/javascript:|vbscript:|data:/gi,/union.*select|insert.*into|delete.*from/gi,/\.\.\//g,/[<>'"&]{3,}/g];for(let a of r)if(a.test(t))return this.config.logSecurityWarnings&&console.warn(`Dangerous pattern detected in parameter ${e}:`,t),!1}else if(Array.isArray(t)){if(t.length>this.config.maxArraySize)return this.config.logSecurityWarnings&&console.warn(`Parameter array too large for key: ${e}`),!1;for(let r of t)if(!this.validateParameter(`${e}[]`,r))return!1}}return!0}parseQueryString(e){let t={};if(!e)return t;let r=e.split("&");for(let o of r)try{let[i,n]=o.split("=");if(!i)continue;let c,l;try{c=decodeURIComponent(i),l=n?decodeURIComponent(n):""}catch(g){this.log("warn","Failed to decode URI component:",o);continue}if(!this.validateParameter(c,l)){this.log("warn",`Parameter rejected by security filter: ${c}`);continue}let h=this.sanitizeParameter(l);if(c.endsWith("[]")){let g=c.slice(0,-2);if(!this.validateParameter(g,[]))continue;t[g]||(t[g]=[]),t[g].length<this.config.maxArraySize?t[g].push(h):this.config.logSecurityWarnings&&console.warn(`Array parameter ${g} size limit exceeded`)}else t[c]=h}catch(i){this.log("error","Error parsing query parameter:",o,i)}let a=Object.keys(t).length;if(a>this.config.maxParameterCount){this.config.logSecurityWarnings&&console.warn(`Too many parameters (${a}). Limiting to first ${this.config.maxParameterCount}.`);let o={},i=0;for(let[n,c]of Object.entries(t)){if(i>=this.config.maxParameterCount)break;o[n]=c,i++}return o}return t}buildQueryString(e){if(!e||Object.keys(e).length===0)return"";let t=[];for(let[r,a]of Object.entries(e))if(Array.isArray(a))for(let o of a)t.push(`${encodeURIComponent(r)}[]=${encodeURIComponent(o)}`);else a!=null&&t.push(`${encodeURIComponent(r)}=${encodeURIComponent(a)}`);return t.join("&")}hasQueryParamsChanged(e){if(!this.currentQueryParams&&!e)return!1;if(!this.currentQueryParams||!e)return!0;let t=Object.keys(this.currentQueryParams),r=Object.keys(e);if(t.length!==r.length)return!0;for(let a of t)if(JSON.stringify(this.currentQueryParams[a])!==JSON.stringify(e[a]))return!0;return!1}getQueryParams(){return{...this.currentQueryParams}}getQueryParam(e){return this.currentQueryParams?this.currentQueryParams[e]:void 0}setQueryParams(e,t=!1){if(!e||typeof e!="object"){console.warn("Invalid parameters object provided to setQueryParams");return}let r=t?{}:{...this.currentQueryParams},a={};for(let[i,n]of Object.entries(e)){if(!this.validateParameter(i,n)){console.warn(`Parameter ${i} rejected by security filter`);continue}n!=null&&(Array.isArray(n)?a[i]=n.map(c=>this.sanitizeParameter(c)):a[i]=this.sanitizeParameter(n))}Object.assign(r,a);for(let[i,n]of Object.entries(r))(n==null||n==="")&&delete r[i];let o=Object.keys(r).length;o>this.config.maxParameterCount&&this.config.logSecurityWarnings&&console.warn(`Too many parameters after update (${o}). Some parameters may be dropped.`),this.currentQueryParams=r,this.updateURL()}removeQueryParams(e){if(!e)return;let t=Array.isArray(e)?e:[e];for(let r of t)delete this.currentQueryParams[r];this.updateURL()}clearQueryParams(){this.currentQueryParams={},this.updateURL()}setCurrentQueryParams(e){this.currentQueryParams=e||{}}updateURL(){if(this.router&&typeof this.router.updateURL=="function"){let e=this.router.currentHash||"home";this.router.updateURL(e,this.currentQueryParams)}}getStats(){return{currentParams:Object.keys(this.currentQueryParams).length,maxAllowed:this.config.maxParameterCount,validationEnabled:this.config.enableParameterValidation,currentQueryString:this.buildQueryString(this.currentQueryParams)}}destroy(){this.currentQueryParams={},this.router=null,this.log("debug","QueryManager destroyed")}};var C=class{constructor(e,t={}){this.config={basePath:t.basePath||"/src",routesPath:t.routesPath||"/routes",environment:t.environment||"development",useLayout:t.useLayout!==!1,defaultLayout:t.defaultLayout||"default",useComponents:t.useComponents!==!1,debug:t.debug||!1},this.router=e,this.log("debug","RouteLoader initialized with config:",this.config)}async loadScript(e){let t;try{if(this.config.environment==="production"){let r=`${this.config.routesPath}/${e}.js`;this.log("debug",`Loading production route: ${r}`),t=(await import(r)).default}else{let r=`${this.config.basePath}/logic/${e}.js`;this.log("debug",`Loading development route: ${r}`),t=(await import(r)).default}if(!t)throw new Error(`Route '${e}' not found - no default export`)}catch(r){throw r.message.includes("Failed to resolve")||r.message.includes("Failed to fetch")||r.message.includes("not found")||r.name==="TypeError"?new Error(`Route '${e}' not found - 404`):r}return t}async loadTemplate(e){try{let t=await fetch(`${this.config.basePath}/views/${e}.html`);if(!t.ok)throw new Error(`Template not found: ${t.status}`);let r=await t.text();return this.log("debug",`Template '${e}' loaded successfully`),r}catch(t){return this.log("warn",`Template '${e}' not found, using default:`,t.message),this.generateDefaultTemplate(e)}}async loadStyle(e){try{let t=await fetch(`${this.config.basePath}/styles/${e}.css`);if(!t.ok)throw new Error(`Style not found: ${t.status}`);let r=await t.text();return this.log("debug",`Style '${e}' loaded successfully`),r}catch(t){return this.log("debug",`Style '${e}' not found, no styles applied:`,t.message),""}}async loadLayout(e){try{let t=await fetch(`${this.config.basePath}/layouts/${e}.html`);if(!t.ok)throw new Error(`Layout not found: ${t.status}`);let r=await t.text();return this.log("debug",`Layout '${e}' loaded successfully`),r}catch(t){return this.log("debug",`Layout '${e}' not found, no layout applied:`,t.message),null}}mergeLayoutWithTemplate(e,t,r){let a;return t.includes("{{ content }}")?a=t.replace(/{{ content }}/s,r):t.includes('class="main-content"')?(this.log("debug","Using main-content replacement"),a=t.replace(/(<div class="container">).*?(<\/div>\s*<\/main>)/s,`$1${r}$2`)):(this.log("debug","Wrapping template with layout"),a=`${t}
${r}`),a}async createVueComponent(e){var g,m;let t=`component_${e}`,r=(g=this.router.cacheManager)==null?void 0:g.getFromCache(t);if(r)return r;let a=await this.loadScript(e),o=this.router,i=this.config.environment==="production",n,c="",l=null;i?n=a.template||this.generateDefaultTemplate(e):(n=await this.loadTemplate(e),c=await this.loadStyle(e),l=this.config.useLayout&&a.layout!==null?await this.loadLayout(a.layout||this.config.defaultLayout):null,l&&(n=this.mergeLayoutWithTemplate(e,l,n)));let h={...a,name:a.name||this.toPascalCase(e),template:n,components:this.config.useComponents&&o.componentLoader?await o.componentLoader.loadAllComponents():{},data(){var d,k;return{...a.data?a.data():{},currentRoute:e,pageTitle:a.pageTitle||o.routeLoader.generatePageTitle(e),showHeader:a.showHeader!==!1,headerTitle:a.headerTitle||o.routeLoader.generatePageTitle(e),headerSubtitle:a.headerSubtitle,$query:((d=o.queryManager)==null?void 0:d.getQueryParams())||{},$lang:((k=o.i18nManager)==null?void 0:k.getCurrentLanguage())||o.config.i18nDefaultLanguage,$dataLoading:!1}},computed:{...a.computed||{},params(){var s;return((s=o.queryManager)==null?void 0:s.getQueryParams())||{}}},async mounted(){a.mounted&&await a.mounted.call(this),a.dataURL&&await this.$fetchData()},methods:{...a.methods,navigateTo:(s,u)=>o.navigateTo(s,u),getCurrentRoute:()=>o.getCurrentRoute(),getQueryParams:()=>{var s;return((s=o.queryManager)==null?void 0:s.getQueryParams())||{}},getQueryParam:s=>{var u;return(u=o.queryManager)==null?void 0:u.getQueryParam(s)},setQueryParams:(s,u)=>{var d;return(d=o.queryManager)==null?void 0:d.setQueryParams(s,u)},removeQueryParams:s=>{var u;return(u=o.queryManager)==null?void 0:u.removeQueryParams(s)},$t:(s,u)=>{var d;return((d=o.i18nManager)==null?void 0:d.t(s,u))||s},$i18n:()=>o.i18nManager||null,$isAuthenticated:()=>{var s;return((s=o.authManager)==null?void 0:s.isUserAuthenticated())||!1},$logout:()=>o.authManager?o.navigateTo(o.authManager.handleLogout()):null,$loginSuccess:s=>o.authManager?o.navigateTo(o.authManager.handleLoginSuccess(s)):null,$checkAuth:s=>o.authManager?o.authManager.checkAuthentication(s):Promise.resolve({allowed:!0,reason:"auth_disabled"}),$getToken:()=>{var s;return((s=o.authManager)==null?void 0:s.getAccessToken())||null},$setToken:(s,u)=>{var d;return((d=o.authManager)==null?void 0:d.setAccessToken(s,u))||!1},$removeToken:s=>{var u;return((u=o.authManager)==null?void 0:u.removeAccessToken(s))||null},$getAuthCookie:()=>{var s;return((s=o.authManager)==null?void 0:s.getAuthCookie())||null},$getCookie:s=>{var u;return((u=o.authManager)==null?void 0:u.getCookieValue(s))||null},async $fetchData(){if(a.dataURL){this.$dataLoading=!0;try{let s=await o.routeLoader.fetchComponentData(a.dataURL);o.errorHandler&&o.errorHandler.debug("RouteLoader",`Data fetched for ${e}:`,s),Object.assign(this,s),this.$emit("data-loaded",s)}catch(s){o.errorHandler&&o.errorHandler.warn("RouteLoader",`Failed to fetch data for ${e}:`,s),this.$emit("data-error",s)}finally{this.$dataLoading=!1}}}},_routeName:e};return!i&&c&&(h._style=c),(m=this.router.cacheManager)==null||m.setCache(t,h),h}toPascalCase(e){return e.split(/[-_\s]+/).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join("")}generateDefaultTemplate(e){return`<div class="route-${e}"><h1>Route: ${e}</h1></div>`}async fetchComponentData(e){var t,r;try{let a=((r=this.router.queryManager)==null?void 0:r.buildQueryString((t=this.router.queryManager)==null?void 0:t.getQueryParams()))||"",o=a?`${e}?${a}`:e;this.log("debug",`Fetching data from: ${o}`);let i=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);let n=await i.json();if(typeof n!="object"||n===null)throw new Error("Invalid data format: expected object");return n}catch(a){throw this.log("error","Failed to fetch component data:",a),a}}invalidateCache(e){this.router.cacheManager&&this.router.cacheManager.invalidateComponentCache(e),this.log("debug",`Cache invalidated for route: ${e}`)}getStats(){return{environment:this.config.environment,basePath:this.config.basePath,routesPath:this.config.routesPath,useLayout:this.config.useLayout,useComponents:this.config.useComponents}}generatePageTitle(e){return this.toPascalCase(e).replace(/([A-Z])/g," $1").trim()}log(e,...t){var r;(r=this.router)!=null&&r.errorHandler&&this.router.errorHandler.log(e,"RouteLoader",...t)}destroy(){this.log("debug","RouteLoader destroyed"),this.router=null}};var P=class{constructor(e,t={}){this.config={enableErrorReporting:t.enableErrorReporting!==!1,debug:t.debug||!1,logLevel:t.logLevel||(t.debug?"debug":"info"),environment:t.environment||"development"},this.router=e,this.logLevels={error:0,warn:1,info:2,debug:3},this.log("info","ErrorHandler","ErrorHandler initialized with config:",this.config)}async handleRouteError(e,t){let r=500,a="\uD398\uC774\uC9C0\uB97C \uB85C\uB4DC\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.";this.debug("ErrorHandler","\uC5D0\uB7EC \uC0C1\uC138:",t.message,t.name),t.message.includes("not found")||t.message.includes("404")||t.message.includes("Failed to resolve")||t.message.includes("Failed to fetch")||t.name==="TypeError"&&t.message.includes("resolve")?(r=404,a=`'${e}' \uD398\uC774\uC9C0\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.`):t.message.includes("network")&&!t.message.includes("not found")?(r=503,a="\uB124\uD2B8\uC6CC\uD06C \uC5F0\uACB0\uC744 \uD655\uC778\uD574 \uC8FC\uC138\uC694."):(t.message.includes("permission")||t.message.includes("403"))&&(r=403,a="\uD398\uC774\uC9C0\uC5D0 \uC811\uADFC\uD560 \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4."),this.debug("ErrorHandler",`\uC5D0\uB7EC \uCF54\uB4DC \uACB0\uC815: ${r} (\uB77C\uC6B0\uD2B8: ${e})`),this.config.enableErrorReporting&&this.reportError(e,t,r);try{r===404?await this.load404Page():await this.loadErrorPage(r,a)}catch(o){this.error("ErrorHandler","\uC5D0\uB7EC \uD398\uC774\uC9C0 \uB85C\uB529 \uC2E4\uD328:",o),this.showFallbackErrorPage(r,a)}}async load404Page(){try{this.info("ErrorHandler","Loading 404 page...");let e=await this.createVueComponent("404");await this.renderComponentWithTransition(e,"404"),this.info("ErrorHandler","404 page loaded successfully")}catch(e){this.error("ErrorHandler","404 page loading failed:",e),this.showFallbackErrorPage("404","\uD398\uC774\uC9C0\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.")}}async loadErrorPage(e,t){try{this.info("ErrorHandler",`Loading error page for ${e}...`);let r=await this.createErrorComponent(e,t);await this.renderComponentWithTransition(r,"error"),this.info("ErrorHandler",`Error page ${e} loaded successfully`)}catch(r){this.error("ErrorHandler",`Error page ${e} loading failed:`,r),this.showFallbackErrorPage(e,t)}}async createErrorComponent(e,t){try{let r=await this.createVueComponent("error");return{...r,data(){return{...r.data?r.data():{},errorCode:e,errorMessage:t,showRetry:!0,showGoHome:!0}}}}catch(r){throw this.error("ErrorHandler","Error component load failed:",r),new Error(`Cannot load error page: ${r.message}`)}}showFallbackErrorPage(e,t){let r=document.getElementById("app");if(!r)return;let a=`
            <div class="fallback-error-page" style="
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
                padding: 2rem;
                text-align: center;
                background: #f8f9fa;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            ">
                <div style="
                    background: white;
                    padding: 3rem;
                    border-radius: 12px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
                    max-width: 500px;
                ">
                    <h1 style="
                        font-size: 4rem;
                        margin: 0;
                        color: #dc3545;
                        font-weight: 300;
                    ">${e}</h1>
                    <h2 style="
                        margin: 1rem 0;
                        color: #495057;
                        font-weight: 400;
                    ">${t}</h2>
                    <p style="
                        color: #6c757d;
                        margin-bottom: 2rem;
                        line-height: 1.5;
                    ">\uC694\uCCAD\uD558\uC2E0 \uD398\uC774\uC9C0\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.</p>
                    <button onclick="window.location.hash = '#/'" style="
                        background: #007bff;
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 1rem;
                        transition: background 0.2s;
                    " onmouseover="this.style.background='#0056b3'" onmouseout="this.style.background='#007bff'">
                        \uD648\uC73C\uB85C \uB3CC\uC544\uAC00\uAE30
                    </button>
                </div>
            </div>
        `;r.innerHTML=a,this.info("ErrorHandler",`Fallback error page displayed for ${e}`)}reportError(e,t,r){let a={route:e,errorCode:r,errorMessage:t.message,stack:t.stack,url:window.location.href,userAgent:navigator.userAgent,timestamp:new Date().toISOString(),routerConfig:{environment:this.router.config.environment,mode:this.router.config.mode}};this.error("ErrorHandler","\uB77C\uC6B0\uD130 \uC5D0\uB7EC \uB9AC\uD3EC\uD2B8:",a)}async createVueComponent(e){if(this.router.routeLoader)return await this.router.routeLoader.createVueComponent(e);throw new Error("RouteLoader not available")}async renderComponentWithTransition(e,t){if(this.router.renderComponentWithTransition)return await this.router.renderComponentWithTransition(e,t);throw new Error("Render function not available")}log(e,t,...r){(typeof e!="string"||!this.logLevels.hasOwnProperty(e))&&(r=[t,...r],t=e,e=this.config.debug?"debug":"info");let a=this.logLevels[this.config.logLevel]||this.logLevels.info,o=this.logLevels[e]||this.logLevels.info;if(o>a||this.config.environment==="production"&&o>this.logLevels.warn)return;let i=t?`[${t}]`:"[ViewLogic]",n=new Date().toISOString().substring(11,23);switch(e){case"error":console.error(`${n} ${i}`,...r);break;case"warn":console.warn(`${n} ${i}`,...r);break;case"info":console.info(`${n} ${i}`,...r);break;case"debug":console.log(`${n} ${i}`,...r);break;default:console.log(`${n} ${i}`,...r)}}error(e,...t){this.log("error",e,...t)}warn(e,...t){this.log("warn",e,...t)}info(e,...t){this.log("info",e,...t)}debug(e,...t){this.log("debug",e,...t)}destroy(){this.router=null,this.info("ErrorHandler","ErrorHandler destroyed")}};var v=class{constructor(e=null,t={}){this.config={basePath:t.basePath||"/src/components",debug:t.debug||!1,environment:t.environment||"development",...t},this.router=e,this.loadingPromises=new Map,this.unifiedComponents=null}log(e,...t){var r;(r=this.router)!=null&&r.errorHandler&&this.router.errorHandler.log(e,"ComponentLoader",...t)}async loadComponent(e){if(!e||typeof e!="string")throw new Error("Component name must be a non-empty string");if(this.loadingPromises.has(e))return this.loadingPromises.get(e);let t=this._loadComponentFromFile(e);this.loadingPromises.set(e,t);try{return await t}catch(r){throw r}finally{this.loadingPromises.delete(e)}}async _loadComponentFromFile(e){let t=`${this.config.basePath}/${e}.js`;try{let a=(await import(t)).default;if(!a)throw new Error(`Component '${e}' has no default export`);return a.name||(a.name=e),this.log("debug",`Component '${e}' loaded successfully`),a}catch(r){throw this.log("error",`Failed to load component '${e}':`,r),new Error(`Component '${e}' not found: ${r.message}`)}}clearComponents(){this.loadingPromises.clear(),this.unifiedComponents=null,this.log("debug","All components cleared")}async loadAllComponents(){return this.unifiedComponents?(this.log("debug","Using existing unified components"),this.unifiedComponents):this.config.environment==="production"?await this._loadProductionComponents():await this._loadDevelopmentComponents()}async _loadProductionComponents(){try{let e=`${this.config.routesPath}/_components.js`;this.log("info","[PRODUCTION] Loading unified components from:",e);let t=await import(e);if(typeof t.registerComponents=="function")return this.unifiedComponents=t.components||{},this.log("info",`[PRODUCTION] Unified components loaded: ${Object.keys(this.unifiedComponents).length} components`),this.unifiedComponents;throw new Error("registerComponents function not found in components module")}catch(e){return this.log("warn","[PRODUCTION] Failed to load unified components:",e.message),this.unifiedComponents={},{}}}async _loadDevelopmentComponents(){let e=this._getComponentNames(),t={};this.log("info",`[DEVELOPMENT] Loading individual components: ${e.join(", ")}`);for(let r of e)try{let a=await this.loadComponent(r);a&&(t[r]=a)}catch(a){this.log("warn",`[DEVELOPMENT] Failed to load component ${r}:`,a.message)}return this.unifiedComponents=t,this.log("info",`[DEVELOPMENT] Individual components loaded: ${Object.keys(t).length} components`),t}_getComponentNames(){return Array.isArray(this.config.componentNames)&&this.config.componentNames.length>0?[...this.config.componentNames]:["Button","Modal","Card","Toast","Input","Tabs","Checkbox","Alert","DynamicInclude","HtmlInclude"]}dispose(){this.clearComponents(),this.log("debug","ComponentLoader disposed"),this.router=null}};var $=class{constructor(e={}){this.version=e.version||"1.0.0",this.config=this._buildConfig(e),this.currentHash="",this.currentVueApp=null,this.previousVueApp=null,this.componentLoader=null,this.transitionInProgress=!1,this.isReady=!1,this.readyPromise=null,this._boundHandleRouteChange=this.handleRouteChange.bind(this),this.readyPromise=this.initialize()}_buildConfig(e){return{...{basePath:"/src",mode:"hash",cacheMode:"memory",cacheTTL:3e5,maxCacheSize:50,useLayout:!1,defaultLayout:"default",environment:"development",routesPath:"/routes",enableErrorReporting:!0,useComponents:!0,componentNames:["Button","Modal","Card","Toast","Input","Tabs","Checkbox","Alert","DynamicInclude","HtmlInclude"],useI18n:!0,defaultLanguage:"ko",logLevel:"info",authEnabled:!1,loginRoute:"login",protectedRoutes:[],protectedPrefixes:[],publicRoutes:["login","register","home"],checkAuthFunction:null,redirectAfterLogin:"home",authCookieName:"authToken",authFallbackCookieNames:["accessToken","token","jwt"],authStorage:"cookie",authCookieOptions:{},authSkipValidation:!1,enableParameterValidation:!0,maxParameterLength:1e3,maxParameterCount:50,maxArraySize:100,allowedKeyPattern:/^[a-zA-Z0-9_-]+$/,logSecurityWarnings:!0},...e}}log(e,...t){this.errorHandler&&this.errorHandler.log(e,"Router",...t)}async initialize(){try{this.cacheManager=new b(this,this.config),this.routeLoader=new C(this,this.config),this.queryManager=new w(this,this.config),this.errorHandler=new P(this,this.config),this.config.useI18n&&(this.i18nManager=new p(this,this.config),this.i18nManager.initPromise&&await this.i18nManager.initPromise),this.config.authEnabled&&(this.authManager=new y(this,this.config)),this.config.useComponents&&(this.componentLoader=new v(this,{...this.config,basePath:this.config.basePath+"/components",cache:!0,componentNames:this.config.componentNames}),await this.componentLoader.loadAllComponents()),this.isReady=!0,this.init()}catch(e){this.log("error","Router initialization failed:",e),this.isReady=!0,this.init()}}async waitForReady(){return this.isReady?!0:(this.readyPromise&&await this.readyPromise,this.isReady)}init(){let e=this.config.mode==="hash";window.addEventListener(e?"hashchange":"popstate",this._boundHandleRouteChange);let t=()=>{e&&!window.location.hash?window.location.hash="#/":!e&&window.location.pathname==="/"?this.navigateTo("home"):this.handleRouteChange()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):requestAnimationFrame(t)}handleRouteChange(){var r,a;let{route:e,queryParams:t}=this._parseCurrentLocation();(r=this.queryManager)==null||r.setCurrentQueryParams(t),(e!==this.currentHash||(a=this.queryManager)!=null&&a.hasQueryParamsChanged(t))&&(this.currentHash=e,this.loadRoute(e))}_parseCurrentLocation(){var e,t;if(this.config.mode==="hash"){let r=window.location.hash.slice(1)||"/",[a,o]=r.split("?"),i="home";return a&&a!=="/"&&(i=a.startsWith("/")?a.slice(1):a),{route:i||"home",queryParams:((e=this.queryManager)==null?void 0:e.parseQueryString(o||window.location.search.slice(1)))||{}}}else return{route:window.location.pathname.slice(1)||"home",queryParams:((t=this.queryManager)==null?void 0:t.parseQueryString(window.location.search.slice(1)))||{}}}async loadRoute(e){if(!this.transitionInProgress)try{if(this.transitionInProgress=!0,!(this.authManager?await this.authManager.checkAuthentication(e):{allowed:!0,reason:"auth_disabled"}).allowed){if(this.authManager){this.authManager.emitAuthEvent("auth_required",{originalRoute:e,loginRoute:this.config.loginRoute});let i=e!==this.config.loginRoute?`${this.config.loginRoute}?redirect=${encodeURIComponent(e)}`:this.config.loginRoute;this.navigateTo(i)}return}if(!document.getElementById("app"))throw new Error("App element not found");let o=await this.routeLoader.createVueComponent(e);await this.renderComponentWithTransition(o,e)}catch(r){this.log("error",`Route loading failed [${e}]:`,r.message),this.errorHandler?await this.errorHandler.handleRouteError(e,r):console.error("[Router] No error handler available")}finally{this.transitionInProgress=!1}}async renderComponentWithTransition(e,t){var c;let r=document.getElementById("app");if(!r)return;let a=document.createElement("div");a.className="page-container page-entered",a.id=`page-${t}-${Date.now()}`,r.querySelectorAll(".page-container").forEach(l=>{l.classList.remove("page-entered"),l.classList.add("page-exiting")}),r.appendChild(a),this.config.environment==="development"&&e._style&&this.applyStyle(e._style,t);let{createApp:i}=Vue,n=i(e);n.config.globalProperties.$router={navigateTo:(l,h)=>this.navigateTo(l,h),getCurrentRoute:()=>this.getCurrentRoute(),getQueryParams:()=>{var l;return((l=this.queryManager)==null?void 0:l.getQueryParams())||{}},getQueryParam:l=>{var h;return(h=this.queryManager)==null?void 0:h.getQueryParam(l)},setQueryParams:(l,h)=>{var g;return(g=this.queryManager)==null?void 0:g.setQueryParams(l,h)},removeQueryParams:l=>{var h;return(h=this.queryManager)==null?void 0:h.removeQueryParams(l)},currentRoute:this.currentHash,currentQuery:((c=this.queryManager)==null?void 0:c.getQueryParams())||{}},n.mount(`#${a.id}`),requestAnimationFrame(()=>{this.cleanupPreviousPages(),this.transitionInProgress=!1}),this.currentVueApp&&(this.previousVueApp=this.currentVueApp),this.currentVueApp=n}cleanupPreviousPages(){var a;let e=document.getElementById("app");if(!e)return;let t=document.createDocumentFragment();if(e.querySelectorAll(".page-container.page-exiting").forEach(o=>o.remove()),this.previousVueApp){try{this.previousVueApp.unmount()}catch(o){}this.previousVueApp=null}(a=e.querySelector(".loading"))==null||a.remove()}applyStyle(e,t){let r=document.querySelector(`style[data-route="${t}"]`);if(r&&r.remove(),e){let a=document.createElement("style");a.textContent=e,a.setAttribute("data-route",t),document.head.appendChild(a)}}navigateTo(e,t=null){typeof e=="object"&&(t=e.params||null,e=e.route),e!==this.currentHash&&this.queryManager&&this.queryManager.clearQueryParams(),this.updateURL(e,t)}getCurrentRoute(){return this.currentHash}updateURL(e,t=null){var i,n;let r=t||((i=this.queryManager)==null?void 0:i.getQueryParams())||{},a=((n=this.queryManager)==null?void 0:n.buildQueryString(r))||"",o=(c,l,h=!0)=>{let g=c==="home"?"/":`/${c}`,m=l?`${g}?${l}`:g;return h?`#${m}`:m};if(this.config.mode==="hash"){let c=o(e,a);window.location.hash!==c&&(window.location.hash=c)}else{let c=o(e,a,!1);window.location.pathname===(e==="home"?"/":`/${e}`)?window.history.replaceState({},"",c):window.history.pushState({},"",c),this.handleRouteChange()}}destroy(){var t;window.removeEventListener(this.config.mode==="hash"?"hashchange":"popstate",this._boundHandleRouteChange),this.currentVueApp&&(this.currentVueApp.unmount(),this.currentVueApp=null),this.previousVueApp&&(this.previousVueApp.unmount(),this.previousVueApp=null),Object.values(this).forEach(r=>{r&&typeof r.destroy=="function"&&r.destroy()}),(t=this.cacheManager)==null||t.clearAll();let e=document.getElementById("app");e&&(e.innerHTML=""),this.log("info","Router destroyed")}};export{$ as ViewLogicRouter};

var p=class{constructor(e,t={}){this.config={enabled:t.useI18n!==void 0?t.useI18n:!0,defaultLanguage:t.defaultLanguage||"ko",fallbackLanguage:t.defaultLanguage||"ko",cacheKey:t.cacheKey||"viewlogic_lang",dataCacheKey:t.dataCacheKey||"viewlogic_i18n_data",cacheVersion:t.cacheVersion||"1.0.0",enableDataCache:t.enableDataCache!==!1,debug:t.debug||!1},this.router=e,this.messages=new Map,this.currentLanguage=this.config.defaultLanguage,this.isLoading=!1,this.loadPromises=new Map,this.listeners={languageChanged:[]},this.initPromise=this.init()}async init(){if(!this.config.enabled){this.log("I18n system disabled");return}if(this.loadLanguageFromCache(),this.config.debug&&(this.config.enableDataCache=!1,this.log("Data cache disabled in debug mode")),this.messages.has(this.currentLanguage))this.log("Language messages already loaded:",this.currentLanguage);else try{await this.loadMessages(this.currentLanguage)}catch(e){this.log("Failed to load initial language file:",e)}}loadLanguageFromCache(){try{let e=localStorage.getItem(this.config.cacheKey);e&&this.isValidLanguage(e)&&(this.currentLanguage=e,this.log("Language loaded from cache:",e))}catch(e){this.log("Failed to load language from cache:",e)}}isValidLanguage(e){return typeof e=="string"&&/^[a-z]{2}$/.test(e)}getCurrentLanguage(){return this.currentLanguage}async setLanguage(e){if(!this.isValidLanguage(e))return this.log("Invalid language code:",e),!1;if(this.currentLanguage===e)return this.log("Language already set to:",e),!0;let t=this.currentLanguage;this.currentLanguage=e;try{return await this.loadMessages(e),this.saveLanguageToCache(e),this.emit("languageChanged",{from:t,to:e,messages:this.messages.get(e)}),this.log("Language changed successfully",{from:t,to:e}),!0}catch(a){return this.currentLanguage=t,this.log("Failed to change language:",a),!1}}saveLanguageToCache(e){try{localStorage.setItem(this.config.cacheKey,e),this.log("Language saved to cache:",e)}catch(t){this.log("Failed to save language to cache:",t)}}async loadMessages(e){if(this.messages.has(e))return this.log("Messages already loaded for:",e),this.messages.get(e);if(this.loadPromises.has(e))return this.log("Messages loading in progress for:",e),await this.loadPromises.get(e);let t=this._loadMessagesFromFile(e);this.loadPromises.set(e,t);try{let a=await t;return this.messages.set(e,a),this.loadPromises.delete(e),this.log("Messages loaded successfully for:",e),a}catch(a){throw this.loadPromises.delete(e),a}}async _loadMessagesFromFile(e){if(this.config.enableDataCache){let t=this.getDataFromCache(e);if(t)return this.log("Messages loaded from cache:",e),t}try{let t=await fetch(`../i18n/${e}.json`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let a=await t.json();return this.config.enableDataCache&&this.saveDataToCache(e,a),a}catch(t){if(this.log("Failed to load messages file for:",e,t),e!==this.config.fallbackLanguage)return this.log("Trying fallback language:",this.config.fallbackLanguage),await this._loadMessagesFromFile(this.config.fallbackLanguage);throw new Error(`Failed to load messages for language: ${e}`)}}getDataFromCache(e){try{let t=`${this.config.dataCacheKey}_${e}_${this.config.cacheVersion}`,a=localStorage.getItem(t);if(a){let{data:o,timestamp:n,version:r}=JSON.parse(a);if(r!==this.config.cacheVersion)return this.log("Cache version mismatch, clearing:",e),localStorage.removeItem(t),null;let s=Date.now(),i=1440*60*1e3;return s-n>i?(this.log("Cache expired, removing:",e),localStorage.removeItem(t),null):o}}catch(t){this.log("Failed to read from cache:",t)}return null}saveDataToCache(e,t){try{let a=`${this.config.dataCacheKey}_${e}_${this.config.cacheVersion}`,o={data:t,timestamp:Date.now(),version:this.config.cacheVersion};localStorage.setItem(a,JSON.stringify(o)),this.log("Data saved to cache:",e)}catch(a){this.log("Failed to save to cache:",a)}}t(e,t={}){if(!this.config.enabled)return e;let a=this.messages.get(this.currentLanguage);if(!a)return this.log("No messages loaded for current language:",this.currentLanguage),e;let o=this.getNestedValue(a,e);if(o===void 0){this.log("Translation not found for key:",e);let n=this.messages.get(this.config.fallbackLanguage);if(n&&this.currentLanguage!==this.config.fallbackLanguage){let r=this.getNestedValue(n,e);if(r!==void 0)return this.interpolate(r,t)}return e}return this.interpolate(o,t)}getNestedValue(e,t){return t.split(".").reduce((a,o)=>a&&a[o]!==void 0?a[o]:void 0,e)}interpolate(e,t){return typeof e!="string"?e:e.replace(/\{(\w+)\}/g,(a,o)=>t.hasOwnProperty(o)?t[o]:a)}plural(e,t,a={}){let o=t===1?`${e}.singular`:`${e}.plural`;return this.t(o,{...a,count:t})}getAvailableLanguages(){return["ko","en"]}on(e,t){this.listeners[e]&&this.listeners[e].push(t)}off(e,t){if(this.listeners[e]){let a=this.listeners[e].indexOf(t);a>-1&&this.listeners[e].splice(a,1)}}emit(e,t){this.listeners[e]&&this.listeners[e].forEach(a=>{try{a(t)}catch(o){this.log("Error in event listener:",o)}})}getMessages(){return this.messages.get(this.currentLanguage)||{}}formatDate(e,t={}){let a=this.currentLanguage==="ko"?"ko-KR":"en-US";return new Intl.DateTimeFormat(a,t).format(new Date(e))}formatNumber(e,t={}){let a=this.currentLanguage==="ko"?"ko-KR":"en-US";return new Intl.NumberFormat(a,t).format(e)}log(...e){this.config.debug&&console.log("[I18n]",...e)}isEnabled(){return this.config.enabled}async isReady(){if(!this.config.enabled)return!0;try{return await this.initPromise,!0}catch(e){return this.log("I18n initialization failed:",e),!1}}clearCache(){try{let t=Object.keys(localStorage).filter(a=>a.startsWith(this.config.dataCacheKey));t.forEach(a=>{localStorage.removeItem(a)}),this.log("Cache cleared, removed",t.length,"items")}catch(e){this.log("Failed to clear cache:",e)}}updateConfig(e){let t=this.config.cacheVersion;this.config={...this.config,...e},e.cacheVersion&&e.cacheVersion!==t&&this.clearCache(),e.hasOwnProperty("enabled")&&e.enabled&&!this.isInitialized&&this.init(),this.log("Config updated:",this.config)}getCacheInfo(){let e={enabled:this.config.enableDataCache,version:this.config.cacheVersion,languages:{}};try{Object.keys(localStorage).filter(o=>o.startsWith(this.config.dataCacheKey)).forEach(o=>{let n=o.match(new RegExp(`${this.config.dataCacheKey}_(w+)_(.+)`));if(n){let[,r,s]=n,i=JSON.parse(localStorage.getItem(o));e.languages[r]={version:s,timestamp:i.timestamp,age:Date.now()-i.timestamp}}})}catch(t){this.log("Failed to get cache info:",t)}return e}async initialize(){if(!this.config.enabled)return this.log("I18n system is disabled, skipping initialization"),!0;try{return await this.initPromise,this.log("I18n system fully initialized"),!0}catch(e){return this.log("Failed to initialize I18n system:",e),!1}}};var y=class{constructor(e,t={}){this.config={showLoadingProgress:t.showLoadingProgress===!0,loadingMinDuration:t.loadingMinDuration||300,debug:t.debug||!1},this.router=e,this.transitionInProgress=!1,this.loadingStartTime=null,this.progressBar=null,this.loadingOverlay=null,this.progressInterval=null,this.init()}init(){this.config.showLoadingProgress&&this.createProgressBar(),this.addLoadingStyles()}createProgressBar(){let e=document.createElement("div");e.className="loading-progress",e.style.display="none";let t=document.createElement("div");t.className="loading-progress-bar",e.appendChild(t),document.body.appendChild(e),this.progressBar={container:e,bar:t}}showLoading(){this.transitionInProgress=!0,this.loadingStartTime=Date.now(),this.config.showLoadingProgress&&this.progressBar&&(this.progressBar.container.style.display="block",this.progressBar.bar.style.width="0%",this.animateProgress())}animateProgress(){let e=0;this.progressInterval=setInterval(()=>{e+=Math.random()*15,e>90&&(e=90),this.progressBar&&this.progressBar.bar&&(this.progressBar.bar.style.width=e+"%"),this.transitionInProgress||(clearInterval(this.progressInterval),this.progressBar&&this.progressBar.bar&&(this.progressBar.bar.style.width="100%"))},200)}async hideLoading(){let e=Date.now()-this.loadingStartTime,t=this.config.loadingMinDuration;e<t&&await new Promise(a=>setTimeout(a,t-e)),this.progressBar&&(this.progressBar.bar.style.width="100%",setTimeout(()=>{this.progressBar&&(this.progressBar.container.style.display="none",this.progressBar.bar.style.width="0%")},200)),this.loadingOverlay&&(this.loadingOverlay.style.opacity="0",setTimeout(()=>{this.loadingOverlay&&this.loadingOverlay.parentNode&&(this.loadingOverlay.remove(),this.loadingOverlay=null)},300)),this.transitionInProgress=!1,this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=null)}showFullPageLoading(e="\uB85C\uB529 \uC911..."){this.hideLoading();let t=document.createElement("div");t.className="page-loading-overlay",t.innerHTML=`
            <div class="loading-container">
                <div class="loading-spinner">
                    <div class="spinner-ring"></div>
                    <div class="spinner-ring"></div>
                    <div class="spinner-ring"></div>
                    <div class="spinner-ring"></div>
                </div>
                <p class="loading-text">${e}</p>
            </div>
        `,document.body.appendChild(t),this.loadingOverlay=t,requestAnimationFrame(()=>{t.style.opacity="1"})}addLoadingStyles(){if(document.querySelector("#loading-manager-styles"))return;let e=document.createElement("style");e.id="loading-manager-styles",e.textContent=`
            .loading-progress {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: rgba(0, 0, 0, 0.1);
                z-index: 9999;
            }

            .loading-progress-bar {
                height: 100%;
                background: linear-gradient(90deg, #3b82f6, #8b5cf6);
                transition: width 0.3s ease;
                border-radius: 0 3px 3px 0;
            }

            .page-loading-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(255, 255, 255, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                opacity: 0;
                transition: opacity 0.3s ease;
                backdrop-filter: blur(2px);
            }

            .loading-container {
                text-align: center;
                padding: 2rem;
            }

            .loading-spinner {
                display: inline-block;
                position: relative;
                width: 64px;
                height: 64px;
                margin-bottom: 1rem;
            }

            .loading-spinner .spinner-ring {
                box-sizing: border-box;
                display: block;
                position: absolute;
                width: 51px;
                height: 51px;
                margin: 6px;
                border: 6px solid #3b82f6;
                border-radius: 50%;
                animation: spinner-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
                border-color: #3b82f6 transparent transparent transparent;
            }

            .loading-spinner .spinner-ring:nth-child(1) {
                animation-delay: -0.45s;
            }

            .loading-spinner .spinner-ring:nth-child(2) {
                animation-delay: -0.3s;
            }

            .loading-spinner .spinner-ring:nth-child(3) {
                animation-delay: -0.15s;
            }

            @keyframes spinner-ring {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .loading-text {
                margin: 0;
                font-size: 1rem;
                color: #6b7280;
                font-weight: 500;
            }

            .loading-state {
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 2rem;
                min-height: 200px;
            }

            .loading-state .loading-spinner {
                margin-bottom: 0;
                transform: scale(0.8);
            }

            .fade-out {
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            @media (max-width: 768px) {
                .loading-container {
                    padding: 1rem;
                }

                .loading-spinner {
                    width: 48px;
                    height: 48px;
                }

                .loading-spinner .spinner-ring {
                    width: 38px;
                    height: 38px;
                    margin: 5px;
                    border-width: 4px;
                }

                .loading-text {
                    font-size: 0.9rem;
                }
            }
        `,document.head.appendChild(e)}isTransitionInProgress(){return this.transitionInProgress}setTransitionInProgress(e){this.transitionInProgress=e}removeLoadingElement(e){let t=e.querySelector(".loading");t&&(t.classList.add("fade-out"),setTimeout(()=>{t&&t.parentNode&&t.remove()},300))}updateConfig(e){this.config={...this.config,...e},e.showLoadingProgress&&!this.progressBar&&this.createProgressBar()}destroy(){this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=null),this.progressBar&&(this.progressBar.container&&this.progressBar.container.parentNode&&this.progressBar.container.remove(),this.progressBar=null),this.loadingOverlay&&this.loadingOverlay.parentNode&&(this.loadingOverlay.remove(),this.loadingOverlay=null);let e=document.querySelector("#loading-manager-styles");e&&e.remove()}log(...e){this.config.debug&&console.log("[LoadingManager]",...e)}};var b=class{constructor(e,t={}){this.config={preloadRoutes:t.preloadRoutes||[],preloadDelay:t.preloadDelay||1e3,preloadInterval:t.preloadInterval||500,debug:t.debug||!1},this.preloadedRoutes=new Set,this.preloadQueue=[],this.isProcessing=!1,this.router=e,this.log("PreloadManager initialized with routes:",this.config.preloadRoutes)}async startPreloading(e=""){if(this.config.preloadRoutes.length===0){this.log("No routes to preload");return}this.log(`\u{1F680} Starting preload for routes: [${this.config.preloadRoutes.join(", ")}]`);for(let t of this.config.preloadRoutes)!this.preloadedRoutes.has(t)&&t!==e&&this.preloadQueue.push(t);this.processPreloadQueue()}async processPreloadQueue(){if(this.preloadQueue.length===0||this.isProcessing)return;this.isProcessing=!0;let e=this.preloadQueue.shift();try{await this.preloadRoute(e),this.preloadedRoutes.add(e),this.log(`\u2705 Preloaded route: ${e}`),setTimeout(()=>{this.isProcessing=!1,this.processPreloadQueue()},this.config.preloadInterval)}catch(t){this.log(`\u26A0\uFE0F Failed to preload route ${e}:`,t.message),setTimeout(()=>{this.isProcessing=!1,this.processPreloadQueue()},this.config.preloadInterval)}}async preloadRoute(e){var t,a,o,n,r,s;if(!this.router)throw new Error("Router instance not provided");try{if((t=this.router.cacheManager)!=null&&t.getFromCache(`script_${e}`)){this.log(`\u2705 Route already cached: ${e}`);return}if(await(((a=this.router.routeLoader)==null?void 0:a.loadScript(e))||this.router.loadScript(e)),this.router.config.environment==="development")try{await(((o=this.router.routeLoader)==null?void 0:o.loadTemplate(e))||this.router.loadTemplate(e)),await(((n=this.router.routeLoader)==null?void 0:n.loadStyle(e))||this.router.loadStyle(e));let i=(r=this.router.cacheManager)==null?void 0:r.getFromCache(`script_${e}`);i&&i.layout&&i.layout!==null&&this.router.config.useLayout&&await(((s=this.router.routeLoader)==null?void 0:s.loadLayout(i.layout))||this.router.loadLayout(i.layout))}catch(i){this.log(`Optional files not found for ${e}:`,i.message)}this.log(`\u2705 Preloaded route: ${e}`)}catch(i){throw this.log(`\u26A0\uFE0F Preload failed for ${e}:`,i.message),i}}preloadSpecificRoute(e,t=""){!this.preloadedRoutes.has(e)&&e!==t&&(this.preloadQueue.unshift(e),this.isProcessing||this.processPreloadQueue())}isPreloaded(e){return this.preloadedRoutes.has(e)}getPreloadedRoutes(){return Array.from(this.preloadedRoutes)}getQueueStatus(){return{queue:[...this.preloadQueue],preloaded:this.getPreloadedRoutes(),isProcessing:this.isProcessing,remaining:this.preloadQueue.length}}setRouter(e){this.router=e,this.log("Router instance updated")}updateConfig(e){let t=[...this.config.preloadRoutes];if(this.config={...this.config,...e},e.preloadRoutes&&JSON.stringify(t)!==JSON.stringify(e.preloadRoutes)){this.log("Preload routes updated:",e.preloadRoutes);for(let a of e.preloadRoutes)!this.preloadedRoutes.has(a)&&!this.preloadQueue.includes(a)&&this.preloadQueue.push(a);!this.isProcessing&&this.preloadQueue.length>0&&this.processPreloadQueue()}}clearCache(){this.preloadedRoutes.clear(),this.preloadQueue=[],this.isProcessing=!1,this.log("Preload cache cleared")}invalidateRoute(e){this.preloadedRoutes.delete(e);let t=this.preloadQueue.indexOf(e);t>-1&&this.preloadQueue.splice(t,1),this.log(`Invalidated preload cache for route: ${e}`)}stop(){this.isProcessing=!1,this.preloadQueue=[],this.log("Preloading stopped")}startDelayedPreloading(e=""){setTimeout(()=>{this.startPreloading(e)},this.config.preloadDelay)}getStats(){return{totalPreloadRoutes:this.config.preloadRoutes.length,preloadedCount:this.preloadedRoutes.size,queuedCount:this.preloadQueue.length,isProcessing:this.isProcessing,preloadRatio:this.config.preloadRoutes.length>0?(this.preloadedRoutes.size/this.config.preloadRoutes.length*100).toFixed(1)+"%":"0%"}}log(...e){this.config.debug&&console.log("[PreloadManager]",...e)}destroy(){this.stop(),this.clearCache(),this.routeLoader=null,this.log("PreloadManager destroyed")}};var C=class{constructor(e,t={}){this.config={enabled:t.authEnabled||!1,loginRoute:t.loginRoute||"login",protectedRoutes:t.protectedRoutes||[],protectedPrefixes:t.protectedPrefixes||[],publicRoutes:t.publicRoutes||["login","register","home"],checkAuthFunction:t.checkAuthFunction||null,redirectAfterLogin:t.redirectAfterLogin||"home",authCookieName:t.authCookieName||"authToken",authFallbackCookieNames:t.authFallbackCookieNames||["accessToken","token","jwt"],authStorage:t.authStorage||"cookie",authCookieOptions:t.authCookieOptions||{},authSkipValidation:t.authSkipValidation||!1,debug:t.debug||!1},this.router=e,this.eventListeners=new Map,this.log("AuthManager initialized",{enabled:this.config.enabled})}async checkAuthentication(e){if(!this.config.enabled)return{allowed:!0,reason:"auth_disabled"};if(this.log(`\u{1F510} Checking authentication for route: ${e}`),this.isPublicRoute(e))return{allowed:!0,reason:"public_route"};if(!this.isProtectedRoute(e))return{allowed:!0,reason:"not_protected"};if(typeof this.config.checkAuthFunction=="function")try{let o=await this.config.checkAuthFunction(e);return{allowed:o,reason:o?"custom_auth_success":"custom_auth_failed",routeName:e}}catch(o){return this.log("Custom auth function failed:",o),{allowed:!1,reason:"custom_auth_error",error:o}}let a=this.isUserAuthenticated();return{allowed:a,reason:a?"authenticated":"not_authenticated",routeName:e}}isUserAuthenticated(){this.log("\u{1F50D} Checking user authentication status");let e=localStorage.getItem("authToken")||localStorage.getItem("accessToken");if(e)try{if(e.includes(".")){let o=JSON.parse(atob(e.split(".")[1]));if(o.exp&&Date.now()>=o.exp*1e3)return this.log("localStorage token expired, removing..."),localStorage.removeItem("authToken"),localStorage.removeItem("accessToken"),!1}return this.log("\u2705 Valid token found in localStorage"),!0}catch(o){this.log("Invalid token in localStorage:",o)}if(sessionStorage.getItem("authToken")||sessionStorage.getItem("accessToken"))return this.log("\u2705 Token found in sessionStorage"),!0;let a=this.getAuthCookie();if(a)try{if(a.includes(".")){let o=JSON.parse(atob(a.split(".")[1]));if(o.exp&&Date.now()>=o.exp*1e3)return this.log("Cookie token expired, removing..."),this.removeAuthCookie(),!1}return this.log("\u2705 Valid token found in cookies"),!0}catch(o){this.log("Cookie token validation failed:",o)}return window.user||window.isAuthenticated?(this.log("\u2705 Global authentication variable found"),!0):(this.log("\u274C No valid authentication found"),!1)}isPublicRoute(e){return this.config.publicRoutes.includes(e)}isProtectedRoute(e){if(this.config.protectedRoutes.includes(e))return!0;for(let t of this.config.protectedPrefixes)if(e.startsWith(t))return!0;return!1}getAuthCookie(){let e=this.getCookieValue(this.config.authCookieName);if(e)return e;for(let t of this.config.authFallbackCookieNames){let a=this.getCookieValue(t);if(a)return this.log(`Found auth token in fallback cookie: ${t}`),a}return null}getCookieValue(e){let a=`; ${document.cookie}`.split(`; ${e}=`);return a.length===2?decodeURIComponent(a.pop().split(";").shift()):null}removeAuthCookie(){[this.config.authCookieName,...this.config.authFallbackCookieNames].forEach(t=>{document.cookie=`${t}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`,document.cookie=`${t}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${window.location.pathname};`}),this.log("Auth cookies removed")}getAccessToken(){let e=localStorage.getItem("authToken")||localStorage.getItem("accessToken");return e||(e=sessionStorage.getItem("authToken")||sessionStorage.getItem("accessToken"),e)||(e=this.getAuthCookie(),e)?e:null}setAccessToken(e,t={}){if(!e)return this.log("Empty token provided"),!1;let{storage:a=this.config.authStorage,cookieOptions:o=this.config.authCookieOptions,skipValidation:n=this.config.authSkipValidation}=t;try{if(!n&&e.includes("."))try{let r=JSON.parse(atob(e.split(".")[1]));if(r.exp&&Date.now()>=r.exp*1e3)return this.log("\u274C Token is expired"),!1;this.log("\u2705 JWT token validated")}catch(r){this.log("\u26A0\uFE0F JWT validation failed, but proceeding:",r.message)}switch(a){case"localStorage":localStorage.setItem("authToken",e),this.log("Token saved to localStorage");break;case"sessionStorage":sessionStorage.setItem("authToken",e),this.log("Token saved to sessionStorage");break;case"cookie":this.setAuthCookie(e,o);break;default:localStorage.setItem("authToken",e),this.log("Token saved to localStorage (default)")}return this.emitAuthEvent("token_set",{storage:a,tokenLength:e.length,hasExpiration:e.includes(".")}),!0}catch(r){return this.log("Failed to set token:",r),!1}}setAuthCookie(e,t={}){let{cookieName:a=this.config.authCookieName,secure:o=window.location.protocol==="https:",sameSite:n="Strict",path:r="/",domain:s=null}=t,i=`${a}=${encodeURIComponent(e)}; path=${r}`;o&&(i+="; Secure"),n&&(i+=`; SameSite=${n}`),s&&(i+=`; Domain=${s}`);try{if(e.includes("."))try{let h=JSON.parse(atob(e.split(".")[1]));if(h.exp){let c=new Date(h.exp*1e3);i+=`; Expires=${c.toUTCString()}`}}catch(h){this.log("Could not extract expiration from JWT token")}}catch(h){this.log("Token processing error:",h)}document.cookie=i,this.log(`Auth cookie set: ${a}`)}removeAccessToken(e="all"){switch(e){case"localStorage":localStorage.removeItem("authToken"),localStorage.removeItem("accessToken");break;case"sessionStorage":sessionStorage.removeItem("authToken"),sessionStorage.removeItem("accessToken");break;case"cookie":this.removeAuthCookie();break;case"all":default:localStorage.removeItem("authToken"),localStorage.removeItem("accessToken"),sessionStorage.removeItem("authToken"),sessionStorage.removeItem("accessToken"),this.removeAuthCookie();break}this.emitAuthEvent("token_removed",{storage:e}),this.log(`Token removed from: ${e}`)}handleLoginSuccess(e=null){let t=e||this.config.redirectAfterLogin;return this.log(`\u{1F389} Login success, redirecting to: ${t}`),this.emitAuthEvent("login_success",{targetRoute:t}),this.router&&typeof this.router.navigateTo=="function"&&this.router.navigateTo(t),t}handleLogout(){return this.log("\u{1F44B} Logging out user"),this.removeAccessToken(),window.user&&(window.user=null),window.isAuthenticated&&(window.isAuthenticated=!1),this.emitAuthEvent("logout",{}),this.router&&typeof this.router.navigateTo=="function"&&this.router.navigateTo(this.config.loginRoute),this.config.loginRoute}emitAuthEvent(e,t){let a=new CustomEvent("router:auth",{detail:{type:e,timestamp:Date.now(),...t}});document.dispatchEvent(a),this.eventListeners.has(e)&&this.eventListeners.get(e).forEach(o=>{try{o(t)}catch(n){this.log("Event listener error:",n)}}),this.log(`\u{1F514} Auth event emitted: ${e}`,t)}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}off(e,t){if(this.eventListeners.has(e)){let a=this.eventListeners.get(e),o=a.indexOf(t);o>-1&&a.splice(o,1)}}getAuthStats(){return{enabled:this.config.enabled,isAuthenticated:this.isUserAuthenticated(),hasToken:!!this.getAccessToken(),protectedRoutesCount:this.config.protectedRoutes.length,protectedPrefixesCount:this.config.protectedPrefixes.length,publicRoutesCount:this.config.publicRoutes.length,storage:this.config.authStorage,loginRoute:this.config.loginRoute}}updateConfig(e){let t=this.config.enabled;this.config={...this.config,...e},t!==this.config.enabled&&this.log(`Auth system ${this.config.enabled?"enabled":"disabled"}`),this.log("Auth config updated",this.config)}log(...e){this.config.debug&&console.log("[AuthManager]",...e)}destroy(){this.eventListeners.clear(),this.log("AuthManager destroyed")}};var w=class{constructor(e,t={}){this.config={cacheMode:t.cacheMode||"memory",cacheTTL:t.cacheTTL||3e5,maxCacheSize:t.maxCacheSize||50,debug:t.debug||!1},this.router=e,this.cache=new Map,this.cacheTimestamps=new Map,this.lruOrder=[],this.log("CacheManager initialized with config:",this.config)}setCache(e,t){let a=Date.now();if(this.config.cacheMode==="lru"){if(this.cache.size>=this.config.maxCacheSize&&!this.cache.has(e)){let n=this.lruOrder.shift();n&&(this.cache.delete(n),this.cacheTimestamps.delete(n),this.log(`\u{1F5D1}\uFE0F LRU evicted cache key: ${n}`))}let o=this.lruOrder.indexOf(e);o>-1&&this.lruOrder.splice(o,1),this.lruOrder.push(e)}this.cache.set(e,t),this.cacheTimestamps.set(e,a),this.log(`\u{1F4BE} Cached: ${e} (size: ${this.cache.size})`)}getFromCache(e){let t=Date.now(),a=this.cacheTimestamps.get(e);if(a&&t-a>this.config.cacheTTL){if(this.cache.delete(e),this.cacheTimestamps.delete(e),this.config.cacheMode==="lru"){let n=this.lruOrder.indexOf(e);n>-1&&this.lruOrder.splice(n,1)}return this.log(`\u23F0 Cache expired and removed: ${e}`),null}let o=this.cache.get(e);if(o&&this.config.cacheMode==="lru"){let n=this.lruOrder.indexOf(e);n>-1&&(this.lruOrder.splice(n,1),this.lruOrder.push(e))}return o?this.log(`\u{1F3AF} Cache hit: ${e}`):this.log(`\u274C Cache miss: ${e}`),o}hasCache(e){return this.cache.has(e)&&this.getFromCache(e)!==null}invalidateByPattern(e){let t=[];for(let a of this.cache.keys())(a.includes(e)||a.startsWith(e))&&t.push(a);return t.forEach(a=>{if(this.cache.delete(a),this.cacheTimestamps.delete(a),this.config.cacheMode==="lru"){let o=this.lruOrder.indexOf(a);o>-1&&this.lruOrder.splice(o,1)}}),this.log(`\u{1F9F9} Invalidated ${t.length} cache entries matching: ${e}`),t.length}invalidateComponentCache(e){let t=[`component_${e}`,`script_${e}`,`template_${e}`,`style_${e}`,`layout_${e}`],a=0;return t.forEach(o=>{a+=this.invalidateByPattern(o)}),this.log(`\u{1F504} Invalidated component cache for route: ${e} (${a} entries)`),a}clearComponentCache(){let e=["component_","script_","template_","style_","layout_"],t=0;return e.forEach(a=>{t+=this.invalidateByPattern(a)}),this.log(`\u{1F9FD} Cleared all component caches (${t} entries)`),t}clearCache(){let e=this.cache.size;this.cache.clear(),this.cacheTimestamps.clear(),this.lruOrder=[],this.log(`\u{1F525} Cleared all cache (${e} entries)`)}cleanExpiredCache(){let e=Date.now(),t=[];for(let[a,o]of this.cacheTimestamps.entries())e-o>this.config.cacheTTL&&t.push(a);return t.forEach(a=>{if(this.cache.delete(a),this.cacheTimestamps.delete(a),this.config.cacheMode==="lru"){let o=this.lruOrder.indexOf(a);o>-1&&this.lruOrder.splice(o,1)}}),t.length>0&&this.log(`\u23F1\uFE0F Cleaned ${t.length} expired cache entries`),t.length}getCacheStats(){return{size:this.cache.size,maxSize:this.config.maxCacheSize,mode:this.config.cacheMode,ttl:this.config.cacheTTL,memoryUsage:this.getMemoryUsage(),hitRatio:this.getHitRatio(),categories:this.getCategorizedStats()}}getMemoryUsage(){let e=0;for(let[t,a]of this.cache.entries())e+=t.length*2,typeof a=="string"?e+=a.length*2:typeof a=="object"&&a!==null?e+=JSON.stringify(a).length*2:e+=8;return{bytes:e,kb:Math.round(e/1024*100)/100,mb:Math.round(e/(1024*1024)*100)/100}}getHitRatio(){let e=this.cache.size>0?Math.min(this.cache.size/this.config.maxCacheSize,1):0;return Math.round(e*100)}getCategorizedStats(){let e={components:0,scripts:0,templates:0,styles:0,layouts:0,others:0};for(let t of this.cache.keys())t.startsWith("component_")?e.components++:t.startsWith("script_")?e.scripts++:t.startsWith("template_")?e.templates++:t.startsWith("style_")?e.styles++:t.startsWith("layout_")?e.layouts++:e.others++;return e}getCacheKeys(){return Array.from(this.cache.keys())}getCacheKeysByPattern(e){return this.getCacheKeys().filter(t=>t.includes(e)||t.startsWith(e))}updateConfig(e){let t=this.config.maxCacheSize;if(this.config={...this.config,...e},this.config.cacheMode==="lru"&&this.config.maxCacheSize<t&&this.cache.size>this.config.maxCacheSize){let a=this.cache.size-this.config.maxCacheSize;this.lruOrder.slice(0,a).forEach(n=>{this.cache.delete(n),this.cacheTimestamps.delete(n)}),this.lruOrder=this.lruOrder.slice(a),this.log(`\u{1F527} Config updated, removed ${a} cache entries to fit new max size`)}this.log("Cache config updated:",this.config)}startAutoCleanup(e=6e4){this.cleanupInterval&&clearInterval(this.cleanupInterval),this.cleanupInterval=setInterval(()=>{this.cleanExpiredCache()},e),this.log(`\u{1F916} Auto cleanup started (interval: ${e}ms)`)}stopAutoCleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null,this.log("\u{1F6D1} Auto cleanup stopped"))}log(...e){this.config.debug&&console.log("[CacheManager]",...e)}destroy(){this.stopAutoCleanup(),this.clearCache(),this.log("CacheManager destroyed")}};var P=class{constructor(e,t={}){this.config={enableParameterValidation:t.enableParameterValidation!==!1,logSecurityWarnings:t.logSecurityWarnings!==!1,maxParameterLength:t.maxParameterLength||1e3,maxArraySize:t.maxArraySize||100,maxParameterCount:t.maxParameterCount||50,allowedKeyPattern:t.allowedKeyPattern||/^[a-zA-Z0-9_\-]+$/,debug:t.debug||!1},this.router=e,this.currentQueryParams={},this.log("QueryManager initialized with config:",this.config)}sanitizeParameter(e){if(typeof e!="string")return e;let t=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/<object\b[^<]*(?:(?!<\/object>)<[^<]*)*<\/object>/gi,"").replace(/<embed\b[^<]*(?:(?!<\/embed>)<[^<]*)*<\/embed>/gi,"").replace(/<link\b[^<]*>/gi,"").replace(/<meta\b[^<]*>/gi,"").replace(/javascript:/gi,"").replace(/vbscript:/gi,"").replace(/data:/gi,"").replace(/on\w+\s*=/gi,"").replace(/expression\s*\(/gi,"").replace(/url\s*\(/gi,""),a=[/(\b(union|select|insert|update|delete|drop|create|alter|exec|execute|sp_|xp_)\b)/gi,/(;|\||&|\*|%|<|>)/g,/(--|\/\*|\*\/)/g,/(\bor\b.*\b=\b|\band\b.*\b=\b)/gi,/('.*'|".*")/g,/(\\\w+)/g];for(let o of a)t=t.replace(o,"");return t=t.replace(/[<>'"&]{2,}/g,""),t.length>this.config.maxParameterLength&&(t=t.substring(0,this.config.maxParameterLength)),t.trim()}validateParameter(e,t){if(!this.config.enableParameterValidation)return!0;if(typeof e!="string"||e.length===0)return!1;if(!this.config.allowedKeyPattern.test(e))return this.config.logSecurityWarnings&&console.warn(`Invalid parameter key format: ${e}`),!1;if(e.length>50)return this.config.logSecurityWarnings&&console.warn(`Parameter key too long: ${e}`),!1;if(t!=null){if(typeof t=="string"){if(t.length>this.config.maxParameterLength)return this.config.logSecurityWarnings&&console.warn(`Parameter value too long for key: ${e}`),!1;let a=[/<script|<iframe|<object|<embed/gi,/javascript:|vbscript:|data:/gi,/union.*select|insert.*into|delete.*from/gi,/\.\.\//g,/[<>'"&]{3,}/g];for(let o of a)if(o.test(t))return this.config.logSecurityWarnings&&console.warn(`Dangerous pattern detected in parameter ${e}:`,t),!1}else if(Array.isArray(t)){if(t.length>this.config.maxArraySize)return this.config.logSecurityWarnings&&console.warn(`Parameter array too large for key: ${e}`),!1;for(let a of t)if(!this.validateParameter(`${e}[]`,a))return!1}}return!0}parseQueryString(e){let t={};if(!e)return t;let a=e.split("&");for(let n of a)try{let[r,s]=n.split("=");if(!r)continue;let i,h;try{i=decodeURIComponent(r),h=s?decodeURIComponent(s):""}catch(l){this.log("Failed to decode URI component:",n);continue}if(!this.validateParameter(i,h)){this.log(`Parameter rejected by security filter: ${i}`);continue}let c=this.sanitizeParameter(h);if(i.endsWith("[]")){let l=i.slice(0,-2);if(!this.validateParameter(l,[]))continue;t[l]||(t[l]=[]),t[l].length<this.config.maxArraySize?t[l].push(c):this.config.logSecurityWarnings&&console.warn(`Array parameter ${l} size limit exceeded`)}else t[i]=c}catch(r){this.log("Error parsing query parameter:",n,r)}let o=Object.keys(t).length;if(o>this.config.maxParameterCount){this.config.logSecurityWarnings&&console.warn(`Too many parameters (${o}). Limiting to first ${this.config.maxParameterCount}.`);let n={},r=0;for(let[s,i]of Object.entries(t)){if(r>=this.config.maxParameterCount)break;n[s]=i,r++}return n}return t}buildQueryString(e){if(!e||Object.keys(e).length===0)return"";let t=[];for(let[a,o]of Object.entries(e))if(Array.isArray(o))for(let n of o)t.push(`${encodeURIComponent(a)}[]=${encodeURIComponent(n)}`);else o!=null&&t.push(`${encodeURIComponent(a)}=${encodeURIComponent(o)}`);return t.join("&")}hasQueryParamsChanged(e){if(!this.currentQueryParams&&!e)return!1;if(!this.currentQueryParams||!e)return!0;let t=Object.keys(this.currentQueryParams),a=Object.keys(e);if(t.length!==a.length)return!0;for(let o of t)if(JSON.stringify(this.currentQueryParams[o])!==JSON.stringify(e[o]))return!0;return!1}getQueryParams(){return{...this.currentQueryParams}}getQueryParam(e){return this.currentQueryParams?this.currentQueryParams[e]:void 0}setQueryParams(e,t=!1){if(!e||typeof e!="object"){console.warn("Invalid parameters object provided to setQueryParams");return}let a=t?{}:{...this.currentQueryParams},o={};for(let[r,s]of Object.entries(e)){if(!this.validateParameter(r,s)){console.warn(`Parameter ${r} rejected by security filter`);continue}s!=null&&(Array.isArray(s)?o[r]=s.map(i=>this.sanitizeParameter(i)):o[r]=this.sanitizeParameter(s))}Object.assign(a,o);for(let[r,s]of Object.entries(a))(s==null||s==="")&&delete a[r];let n=Object.keys(a).length;n>this.config.maxParameterCount&&this.config.logSecurityWarnings&&console.warn(`Too many parameters after update (${n}). Some parameters may be dropped.`),this.currentQueryParams=a,this.updateURL()}removeQueryParams(e){if(!e)return;let t=Array.isArray(e)?e:[e];for(let a of t)delete this.currentQueryParams[a];this.updateURL()}clearQueryParams(){this.currentQueryParams={},this.updateURL()}setCurrentQueryParams(e){this.currentQueryParams=e||{}}updateURL(){if(this.router&&typeof this.router.updateURL=="function"){let e=this.router.currentHash||"home";this.router.updateURL(e,this.currentQueryParams)}}getStats(){return{currentParams:Object.keys(this.currentQueryParams).length,maxAllowed:this.config.maxParameterCount,validationEnabled:this.config.enableParameterValidation,currentQueryString:this.buildQueryString(this.currentQueryParams)}}updateConfig(e){this.config={...this.config,...e},this.log("QueryManager config updated:",this.config)}log(...e){this.config.debug&&console.log("[QueryManager]",...e)}destroy(){this.currentQueryParams={},this.router=null,this.log("QueryManager destroyed")}};var v=class{constructor(e,t={}){this.config={breakpoint:t.breakpoint||768,debug:t.debug||!1},this.router=e,this.mobileMenuOpen=!1,this.log("MobileManager initialized with config:",this.config),this.initializeEventListeners()}initializeEventListeners(){window.addEventListener("resize",()=>this.handleWindowResize())}toggleMobileMenu(){this.mobileMenuOpen=!this.mobileMenuOpen,this.router.currentVueApp&&(this.router.currentVueApp.config.globalProperties.mobileMenuOpen=this.mobileMenuOpen,this.updateMobileMenuState())}closeMobileMenu(){this.mobileMenuOpen=!1,this.router.currentVueApp&&(this.router.currentVueApp.config.globalProperties.mobileMenuOpen=this.mobileMenuOpen,this.updateMobileMenuState())}updateMobileMenuState(){let e=document.querySelectorAll(".nav-menu, .nav-auth"),t=document.querySelector(".nav-toggle");e.forEach(a=>{this.mobileMenuOpen?a.classList.add("active"):a.classList.remove("active")}),t&&(this.mobileMenuOpen?t.classList.add("active"):t.classList.remove("active")),this.mobileMenuOpen?document.body.style.overflow="hidden":document.body.style.overflow=""}handleWindowResize(){window.innerWidth>this.config.breakpoint&&this.closeMobileMenu()}getMobileMenuOpen(){return this.mobileMenuOpen}setMobileMenuOpen(e){typeof e=="boolean"&&(this.mobileMenuOpen=e,this.updateMobileMenuState())}registerGlobalProperties(e){!e||!e.config||(e.config.globalProperties.mobileMenuOpen=this.mobileMenuOpen,e.config.globalProperties.toggleMobileMenu=()=>this.toggleMobileMenu(),e.config.globalProperties.closeMobileMenu=()=>this.closeMobileMenu(),this.log("Global properties registered to Vue app"))}updateConfig(e){this.config={...this.config,...e},this.log("MobileManager config updated:",this.config)}log(...e){this.config.debug&&console.log("[MobileManager]",...e)}destroy(){window.removeEventListener("resize",()=>this.handleWindowResize()),this.mobileMenuOpen=!1,this.router=null,this.log("MobileManager destroyed")}};var M=class{constructor(e,t={}){this.config={basePath:t.basePath||"/src",routesPath:t.routesPath||"/routes",environment:t.environment||"development",useLayout:t.useLayout!==!1,defaultLayout:t.defaultLayout||"default",useComponents:t.useComponents!==!1,debug:t.debug||!1},this.router=e,this.log("RouteLoader initialized with config:",this.config)}async loadScript(e){var n,r;let t=`script_${e}`,a=(n=this.router.cacheManager)==null?void 0:n.getFromCache(t);if(a)return a;let o;try{if(this.config.environment==="production"){let s=`${this.config.routesPath}/${e}.js`;this.log(`\u{1F4E6} Loading production route: ${s}`),o=(await import(s)).default}else{let s=`${this.config.basePath}/logic/${e}.js`;this.log(`\u{1F6E0}\uFE0F Loading development route: ${s}`),o=(await import(s)).default}if(!o)throw new Error(`Route '${e}' not found - no default export`)}catch(s){throw s.message.includes("Failed to resolve")||s.message.includes("Failed to fetch")||s.message.includes("not found")||s.name==="TypeError"?new Error(`Route '${e}' not found - 404`):s}return(r=this.router.cacheManager)==null||r.setCache(t,o),o}async loadTemplate(e){var r,s;let t=`template_${e}`,a=(r=this.router.cacheManager)==null?void 0:r.getFromCache(t);if(a)return a;let o=await fetch(`${this.config.basePath}/views/${e}.html`);if(!o.ok)throw new Error("Template not found");let n=await o.text();return(s=this.router.cacheManager)==null||s.setCache(t,n),n}async loadStyle(e){var r,s;let t=`style_${e}`,a=(r=this.router.cacheManager)==null?void 0:r.getFromCache(t);if(a)return a;let o=await fetch(`${this.config.basePath}/styles/${e}.css`);if(!o.ok)throw new Error("Style not found");let n=await o.text();return(s=this.router.cacheManager)==null||s.setCache(t,n),n}async loadLayout(e){var o,n;let t=`layout_${e}`,a=(o=this.router.cacheManager)==null?void 0:o.getFromCache(t);if(a)return a;try{let r=await fetch(`${this.config.basePath}/layouts/${e}.html`);if(!r.ok)throw new Error(`Layout not found: ${r.status}`);let s=await r.text();return this.log(`\u2713 Layout '${e}' loaded successfully`),(n=this.router.cacheManager)==null||n.setCache(t,s),s}catch(r){return console.warn(`\u274C Layout '${e}' not found:`,r.message),null}}mergeLayoutWithTemplate(e,t,a){var s,i;let o=`merge_${e}`,n=(s=this.router.cacheManager)==null?void 0:s.getFromCache(o);if(n)return n;let r;return t.includes("{{ content }}")?r=t.replace(/{{ content }}/s,a):t.includes('class="main-content"')?(this.log("\u2713 Using main-content replacement"),r=t.replace(/(<div class="container">).*?(<\/div>\s*<\/main>)/s,`$1${a}$2`)):(this.log("\u2713 Wrapping template with layout"),r=`${t}
${a}`),(i=this.router.cacheManager)==null||i.setCache(o,r),r}async createVueComponent(e){var n,r,s;let t=`component_${e}`,a=(n=this.router.cacheManager)==null?void 0:n.getFromCache(t);if(a)return a;let o=await this.loadScript(e);if(this.config.environment==="production"){let i=this.router,h={...o,name:o.name||this.toPascalCase(e),template:o.template||this.generateDefaultTemplate(e),components:this.config.useComponents&&i.componentLoader?await i.componentLoader.loadAllComponents():{},data(){var l,d;return{...o.data?o.data():{},currentRoute:e,pageTitle:o.pageTitle||i.routeLoader.generatePageTitle(e),showHeader:o.showHeader!==!1,headerTitle:o.headerTitle||i.routeLoader.generatePageTitle(e),headerSubtitle:o.headerSubtitle,$query:((l=i.queryManager)==null?void 0:l.getQueryParams())||{},$lang:((d=i.i18nManager)==null?void 0:d.getCurrentLanguage())||i.config.i18nDefaultLanguage,$dataLoading:!1}},computed:{...o.computed||{},params(){var c;return((c=i.queryManager)==null?void 0:c.getQueryParams())||{}}},async mounted(){o.mounted&&await o.mounted.call(this),o.dataURL&&await this.$fetchData()},methods:{...o.methods,navigateTo:(c,l)=>i.navigateTo(c,l),getCurrentRoute:()=>i.getCurrentRoute(),getQueryParams:()=>{var c;return((c=i.queryManager)==null?void 0:c.getQueryParams())||{}},getQueryParam:c=>{var l;return(l=i.queryManager)==null?void 0:l.getQueryParam(c)},setQueryParams:(c,l)=>{var d;return(d=i.queryManager)==null?void 0:d.setQueryParams(c,l)},removeQueryParams:c=>{var l;return(l=i.queryManager)==null?void 0:l.removeQueryParams(c)},$t:(c,l)=>{var d;return((d=i.i18nManager)==null?void 0:d.t(c,l))||c},$i18n:()=>i.i18nManager||null,$isAuthenticated:()=>i.authManager?i.authManager.isUserAuthenticated():!1,$logout:()=>i.authManager?i.navigateTo(i.authManager.handleLogout()):null,$loginSuccess:c=>i.authManager?i.navigateTo(i.authManager.handleLoginSuccess(c)):null,$checkAuth:c=>i.authManager?i.authManager.checkAuthentication(c):Promise.resolve({allowed:!0,reason:"auth_disabled"}),$getToken:()=>i.authManager?i.authManager.getAccessToken():null,$setToken:(c,l)=>i.authManager?i.authManager.setAccessToken(c,l):!1,$removeToken:c=>i.authManager?i.authManager.removeAccessToken(c):null,$getAuthCookie:()=>i.authManager?i.authManager.getAuthCookie():null,$getCookie:c=>i.authManager?i.authManager.getCookieValue(c):null,async $fetchData(){if(o.dataURL){this.$dataLoading=!0;try{let c=await i.routeLoader.fetchComponentData(o.dataURL);console.log(`\u{1F4CA} Data fetched for ${e}:`,c),Object.assign(this,c),this.$emit("data-loaded",c)}catch(c){console.warn(`\u26A0\uFE0F Failed to fetch data for ${e}:`,c),this.$emit("data-error",c)}finally{this.$dataLoading=!1}}}},_routeName:e};return(r=this.router.cacheManager)==null||r.setCache(t,h),h}else{let i=await this.loadTemplate(e),h=await this.loadStyle(e),c=this.config.useLayout&&o.layout!==null?await this.loadLayout(o.layout||this.config.defaultLayout):null,l=this.router,d={...o,name:o.name||this.toPascalCase(e),template:c?this.mergeLayoutWithTemplate(e,c,i):i,components:this.config.useComponents&&l.componentLoader?await l.componentLoader.loadAllComponents():{},data(){var u,m;return{...o.data?o.data():{},currentRoute:e,pageTitle:o.pageTitle||l.routeLoader.generatePageTitle(e),pageStyle:h,showHeader:o.showHeader!==!1,headerTitle:o.headerTitle||l.routeLoader.generatePageTitle(e),headerSubtitle:o.headerSubtitle,$query:((u=l.queryManager)==null?void 0:u.getQueryParams())||{},$lang:((m=l.i18nManager)==null?void 0:m.getCurrentLanguage())||l.config.i18nDefaultLanguage,$dataLoading:!1}},computed:{...o.computed||{},params(){var g;return((g=l.queryManager)==null?void 0:g.getQueryParams())||{}}},async mounted(){o.mounted&&await o.mounted.call(this),o.dataURL&&await this.$fetchData()},methods:{...o.methods,navigateTo:(g,u)=>l.navigateTo(g,u),getCurrentRoute:()=>l.getCurrentRoute(),getQueryParams:()=>{var g;return((g=l.queryManager)==null?void 0:g.getQueryParams())||{}},getQueryParam:g=>{var u;return(u=l.queryManager)==null?void 0:u.getQueryParam(g)},setQueryParams:(g,u)=>{var m;return(m=l.queryManager)==null?void 0:m.setQueryParams(g,u)},removeQueryParams:g=>{var u;return(u=l.queryManager)==null?void 0:u.removeQueryParams(g)},$t:(g,u)=>{var m;return((m=l.i18nManager)==null?void 0:m.t(g,u))||g},$i18n:()=>l.i18nManager||null,$isAuthenticated:()=>l.authManager?l.authManager.isUserAuthenticated():!1,$logout:()=>l.authManager?l.navigateTo(l.authManager.handleLogout()):null,$loginSuccess:g=>l.authManager?l.navigateTo(l.authManager.handleLoginSuccess(g)):null,$checkAuth:g=>l.authManager?l.authManager.checkAuthentication(g):Promise.resolve({allowed:!0,reason:"auth_disabled"}),$getToken:()=>l.authManager?l.authManager.getAccessToken():null,$setToken:(g,u)=>l.authManager?l.authManager.setAccessToken(g,u):!1,$removeToken:g=>l.authManager?l.authManager.removeAccessToken(g):null,$getAuthCookie:()=>l.authManager?l.authManager.getAuthCookie():null,$getCookie:g=>l.authManager?l.authManager.getCookieValue(g):null,async $fetchData(){if(o.dataURL){this.$dataLoading=!0;try{let g=await l.routeLoader.fetchComponentData(o.dataURL);console.log(`\u{1F4CA} Data fetched for ${e}:`,g),Object.assign(this,g),this.$emit("data-loaded",g)}catch(g){console.warn(`\u26A0\uFE0F Failed to fetch data for ${e}:`,g),this.$emit("data-error",g)}finally{this.$dataLoading=!1}}}},_style:h,_routeName:e,_layout:c};return(s=this.router.cacheManager)==null||s.setCache(t,d),d}}toPascalCase(e){return e.split(/[-_\s]+/).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join("")}generateDefaultTemplate(e){return`<div class="route-${e}"><h1>Route: ${e}</h1></div>`}async fetchComponentData(e){var t,a;try{let o=((a=this.router.queryManager)==null?void 0:a.buildQueryString((t=this.router.queryManager)==null?void 0:t.getQueryParams()))||"",n=o?`${e}?${o}`:e;this.log(`\u{1F310} Fetching data from: ${n}`);let r=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);let s=await r.json();if(typeof s!="object"||s===null)throw new Error("Invalid data format: expected object");return s}catch(o){throw console.error("Failed to fetch component data:",o),o}}invalidateCache(e){this.router.cacheManager&&this.router.cacheManager.invalidateComponentCache(e),this.log(`Cache invalidated for route: ${e}`)}updateConfig(e){this.config={...this.config,...e},this.log("RouteLoader config updated:",this.config)}getStats(){return{environment:this.config.environment,basePath:this.config.basePath,routesPath:this.config.routesPath,useLayout:this.config.useLayout,useComponents:this.config.useComponents}}generatePageTitle(e){return this.toPascalCase(e).replace(/([A-Z])/g," $1").trim()}log(...e){this.config.debug&&console.log("[RouteLoader]",...e)}destroy(){this.router=null,this.log("RouteLoader destroyed")}};var k=class{constructor(e,t={}){this.config={enableErrorReporting:t.enableErrorReporting!==!1,debug:t.debug||!1},this.router=e,this.log("ErrorHandler initialized with config:",this.config)}async handleRouteError(e,t){let a=500,o="\uD398\uC774\uC9C0\uB97C \uB85C\uB4DC\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.";console.log("\uC5D0\uB7EC \uC0C1\uC138:",t.message,t.name),t.message.includes("not found")||t.message.includes("404")||t.message.includes("Failed to resolve")||t.message.includes("Failed to fetch")||t.name==="TypeError"&&t.message.includes("resolve")?(a=404,o=`'${e}' \uD398\uC774\uC9C0\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.`):t.message.includes("network")&&!t.message.includes("not found")?(a=503,o="\uB124\uD2B8\uC6CC\uD06C \uC5F0\uACB0\uC744 \uD655\uC778\uD574 \uC8FC\uC138\uC694."):(t.message.includes("permission")||t.message.includes("403"))&&(a=403,o="\uD398\uC774\uC9C0\uC5D0 \uC811\uADFC\uD560 \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4."),console.log(`\uC5D0\uB7EC \uCF54\uB4DC \uACB0\uC815: ${a} (\uB77C\uC6B0\uD2B8: ${e})`),this.config.enableErrorReporting&&this.reportError(e,t,a);try{a===404?await this.load404Page():await this.loadErrorPage(a,o)}catch(n){console.error("\uC5D0\uB7EC \uD398\uC774\uC9C0 \uB85C\uB529 \uC2E4\uD328:",n),this.showFallbackErrorPage(a,o)}}async load404Page(){try{console.log("\u{1F50D} Loading 404 page...");let e=await this.createVueComponent("404");await this.renderComponentWithTransition(e,"404"),console.log("\u2705 404 page loaded successfully")}catch(e){console.error("\u274C 404 page loading failed:",e),this.showFallbackErrorPage("404","\uD398\uC774\uC9C0\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.")}}async loadErrorPage(e,t){try{console.log(`\u{1F50D} Loading error page for ${e}...`);let a=await this.createErrorComponent(e,t);await this.renderComponentWithTransition(a,"error"),console.log(`\u2705 Error page ${e} loaded successfully`)}catch(a){console.error(`\u274C Error page ${e} loading failed:`,a),this.showFallbackErrorPage(e,t)}}async createErrorComponent(e,t){try{let a=await this.createVueComponent("error");return{...a,data(){return{...a.data?a.data():{},errorCode:e,errorMessage:t,showRetry:!0,showGoHome:!0}}}}catch(a){throw console.error("Error component load failed:",a),new Error(`Cannot load error page: ${a.message}`)}}showFallbackErrorPage(e,t){let a=document.getElementById("app");if(!a)return;let o=`
            <div class="fallback-error-page" style="
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
                padding: 2rem;
                text-align: center;
                background: #f8f9fa;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            ">
                <div style="
                    background: white;
                    padding: 3rem;
                    border-radius: 12px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
                    max-width: 500px;
                ">
                    <h1 style="
                        font-size: 4rem;
                        margin: 0;
                        color: #dc3545;
                        font-weight: 300;
                    ">${e}</h1>
                    <h2 style="
                        margin: 1rem 0;
                        color: #495057;
                        font-weight: 400;
                    ">${t}</h2>
                    <p style="
                        color: #6c757d;
                        margin-bottom: 2rem;
                        line-height: 1.5;
                    ">\uC694\uCCAD\uD558\uC2E0 \uD398\uC774\uC9C0\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.</p>
                    <button onclick="window.location.hash = '#/'" style="
                        background: #007bff;
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 1rem;
                        transition: background 0.2s;
                    " onmouseover="this.style.background='#0056b3'" onmouseout="this.style.background='#007bff'">
                        \uD648\uC73C\uB85C \uB3CC\uC544\uAC00\uAE30
                    </button>
                </div>
            </div>
        `;a.innerHTML=o,console.log(`\u{1F4C4} Fallback error page displayed for ${e}`)}reportError(e,t,a){let o={route:e,errorCode:a,errorMessage:t.message,stack:t.stack,url:window.location.href,userAgent:navigator.userAgent,timestamp:new Date().toISOString(),routerConfig:{environment:this.router.config.environment,mode:this.router.config.mode}};console.error("\uB77C\uC6B0\uD130 \uC5D0\uB7EC \uB9AC\uD3EC\uD2B8:",o)}async createVueComponent(e){if(this.router.routeLoader)return await this.router.routeLoader.createVueComponent(e);throw new Error("RouteLoader not available")}async renderComponentWithTransition(e,t){if(this.router.renderComponentWithTransition)return await this.router.renderComponentWithTransition(e,t);throw new Error("Render function not available")}updateConfig(e){this.config={...this.config,...e},this.log("ErrorHandler config updated:",this.config)}log(...e){this.config.debug&&console.log("[ErrorHandler]",...e)}destroy(){this.router=null,this.log("ErrorHandler destroyed")}};var $=class{constructor(e=null,t={}){e&&typeof e=="object"&&!e.config&&(t=e,e=null),this.config={basePath:t.basePath||"/src/components",cache:t.cache!==!1,globalComponents:t.globalComponents||[],debug:t.debug||!1,...t},this.router=e,this.componentCache=new Map,this.loadingPromises=new Map,this.registeredComponents=new Set,this.unifiedComponentsModule=null}async loadComponent(e){if(this.config.cache&&this.componentCache.has(e))return this.componentCache.get(e);if(this.loadingPromises.has(e))return this.loadingPromises.get(e);let t=this._loadComponentFromFile(e);this.loadingPromises.set(e,t);try{let a=await t;return this.config.cache&&this.componentCache.set(e,a),a}finally{this.loadingPromises.delete(e)}}async _loadComponentFromFile(e){let t=`${this.config.basePath}/${e}.js`;try{let o=(await import(t)).default;if(!o)throw new Error(`Component '${e}' has no default export`);return o.name||(o.name=e),console.log(`\u2705 Component '${e}' loaded successfully`),o}catch(a){throw console.error(`\u274C Failed to load component '${e}':`,a),new Error(`Component '${e}' not found: ${a.message}`)}}registerComponent(e,t,a){if(!e||!e.component)throw new Error("Invalid Vue app instance");e.component(t,a),this.registeredComponents.add(t),console.log(`\u{1F4DD} Component '${t}' registered globally`)}async registerComponents(e,t){let a=t.map(async s=>{try{let i=await this.loadComponent(s);return this.registerComponent(e,s,i),{name:s,component:i,success:!0}}catch(i){return console.warn(`Failed to register component '${s}':`,i),{name:s,error:i,success:!1}}}),o=await Promise.all(a),n=o.filter(s=>s.success),r=o.filter(s=>!s.success);return console.log(`\u{1F4E6} Component registration complete: ${n.length} successful, ${r.length} failed`),{successful:n.map(s=>s.name),failed:r.map(s=>({name:s.name,error:s.error}))}}async registerGlobalComponents(e){return this.config.globalComponents.length===0?{successful:[],failed:[]}:(console.log(`\u{1F30D} Registering global components: ${this.config.globalComponents.join(", ")}`),this.registerComponents(e,this.config.globalComponents))}isComponentRegistered(e){return this.registeredComponents.has(e)}getCachedComponent(e){return this.componentCache.get(e)}clearCache(e=null){e?(this.componentCache.delete(e),console.log(`\u{1F5D1}\uFE0F Component cache cleared for: ${e}`)):(this.componentCache.clear(),console.log("\u{1F5D1}\uFE0F All component cache cleared"))}getCacheInfo(){return{cachedComponents:Array.from(this.componentCache.keys()),registeredComponents:Array.from(this.registeredComponents),loadingComponents:Array.from(this.loadingPromises.keys()),cacheSize:this.componentCache.size}}async loadAllComponents(){if(this.unifiedComponentsModule&&this.unifiedComponentsModule.components)return console.log(`\u{1F4E6} Using unified components (${Object.keys(this.unifiedComponentsModule.components).length} components)`),this.unifiedComponentsModule.components;let e=[];if(Array.isArray(this.config.componentNames)&&this.config.componentNames.length>0)e=[...this.config.componentNames];else if(typeof this.config.getComponentNames=="function")try{let a=await this.config.getComponentNames();Array.isArray(a)&&a.length>0&&(e=[...a])}catch(a){console.warn("getComponentNames() failed, falling back to defaults:",a)}e.length===0&&(e=["Button","Modal","Card","Toast","Input","Tabs","Checkbox","Alert","DynamicInclude","HtmlInclude"]);let t={};for(let a of e)try{let o=await this.loadComponent(a);o&&(t[a]=o)}catch(o){console.warn(`\u274C Failed to load component ${a}:`,o.message)}return console.log(`\u{1F504} Total components loaded: ${Object.keys(t).length}`),t}async loadUnifiedComponents(e){try{let t=`${e}/_components.js`;console.log("\u{1F4E6} Loading unified components from:",t);let a=await import(t);if(console.log("\u{1F4E6} All components module loaded"),typeof a.registerComponents=="function")return this.setUnifiedComponentsModule(a),console.log("\u{1F4E6} Available components:",Object.keys(a.components||{})),!0;throw new Error("registerComponents function not found in components module")}catch(t){throw console.error("\u274C Failed to load unified components:",t),console.error("\u274C Error details:",t.stack),t}}setUnifiedComponentsModule(e){this.unifiedComponentsModule=e,console.log("\u{1F9E9} Unified components module set for ComponentLoader")}async preloadComponents(e){console.log(`\u{1F680} Preloading components: ${e.join(", ")}`);let t=e.map(async r=>{try{return await this.loadComponent(r),{name:r,success:!0}}catch(s){return console.warn(`Failed to preload component '${r}':`,s),{name:r,success:!1,error:s}}}),a=await Promise.all(t),o=a.filter(r=>r.success).map(r=>r.name),n=a.filter(r=>!r.success);return console.log(`\u{1F4E6} Component preloading complete: ${o.length} successful, ${n.length} failed`),{successful:o,failed:n}}};var L=class{constructor(e={}){this.version=e.version||"1.0.0",this.config={basePath:e.basePath||"/src",mode:e.mode||"hash",cacheMode:e.cacheMode||"memory",cacheTTL:e.cacheTTL||3e5,maxCacheSize:e.maxCacheSize||50,useLayout:e.useLayout||!1,defaultLayout:e.defaultLayout||"default",environment:e.environment||"development",routesPath:e.routesPath||"/routes",preloadRoutes:e.preloadRoutes||[],preloadDelay:e.preloadDelay||1e3,preloadInterval:e.preloadInterval||500,showLoadingProgress:e.showLoadingProgress===!0,loadingMinDuration:e.loadingMinDuration||300,enableErrorReporting:e.enableErrorReporting!==!1,useComponents:e.useComponents!==!1,componentNames:e.componentNames||["Button","Modal","Card","Toast","Input","Tabs","Checkbox","Alert","DynamicInclude","HtmlInclude"],useI18n:e.useI18n!==!1,defaultLanguage:e.defaultLanguage||"ko",authEnabled:e.authEnabled||!1,loginRoute:e.loginRoute||"login",protectedRoutes:e.protectedRoutes||[],protectedPrefixes:e.protectedPrefixes||[],publicRoutes:e.publicRoutes||["login","register","home"],checkAuthFunction:e.checkAuthFunction||null,redirectAfterLogin:e.redirectAfterLogin||"home",authCookieName:e.authCookieName||"authToken",authFallbackCookieNames:e.authFallbackCookieNames||["accessToken","token","jwt"],authStorage:e.authStorage||"cookie",authCookieOptions:e.authCookieOptions||{},authSkipValidation:e.authSkipValidation||!1,enableParameterValidation:e.enableParameterValidation!==!1,maxParameterLength:e.maxParameterLength||1e3,maxParameterCount:e.maxParameterCount||50,maxArraySize:e.maxArraySize||100,allowedKeyPattern:e.allowedKeyPattern||/^[a-zA-Z0-9_-]+$/,logSecurityWarnings:e.logSecurityWarnings!==!1},this.currentHash="",this.currentVueApp=null,this.previousVueApp=null,this.componentLoader=null,this.transitionInProgress=!1,this.initializeManagers(),this.init()}initializeManagers(){try{this.cacheManager=new w(this,this.config),this.routeLoader=new M(this,this.config),this.queryManager=new P(this,this.config),this.errorHandler=new k(this,this.config),this.mobileManager=new v(this,this.config),this.config.useI18n&&(this.i18nManager=new p(this,this.config)),this.config.showLoadingProgress&&(this.loadingManager=new y(this,this.config)),this.config.authEnabled&&(this.authManager=new C(this,this.config)),this.config.useComponents&&(this.componentLoader=new $(this,{...this.config,basePath:this.config.basePath+"/components",cache:!0,componentNames:this.config.componentNames}),this.config.environment==="production"&&this.componentLoader.loadUnifiedComponents(this.config.routesPath).catch(e=>{console.warn("Failed to load unified components:",e),this.config.useComponents=!1})),this.config.preloadRoutes&&this.config.preloadRoutes.length>0&&(this.preloadManager=new b(this,this.config),setTimeout(()=>{this.preloadManager&&this.preloadManager.startDelayedPreloading(this.currentHash)},this.config.preloadDelay)),console.log("\u2705 All managers initialized successfully")}catch(e){throw console.error("\u274C Manager initialization failed:",e),e}}init(){this.config.mode==="hash"?(window.addEventListener("hashchange",()=>this.handleRouteChange()),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.handleRouteChange()):setTimeout(()=>this.handleRouteChange(),0),window.location.hash||(window.location.hash="#/")):(window.addEventListener("popstate",()=>this.handleRouteChange()),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.handleRouteChange()):setTimeout(()=>this.handleRouteChange(),0),window.location.pathname==="/"&&this.navigateTo("home"))}handleRouteChange(){var a,o,n,r;let e,t;if(this.config.mode==="hash"){let i=(window.location.hash.slice(1)||"/").split("?"),h=i[0],c=i[1]||window.location.search.slice(1);h==="/"||h===""?e="home":h.startsWith("/")?e=h.slice(1)||"home":e=h||"home",t=((a=this.queryManager)==null?void 0:a.parseQueryString(c))||{}}else e=window.location.pathname.slice(1)||"home",t=((o=this.queryManager)==null?void 0:o.parseQueryString(window.location.search.slice(1)))||{};(n=this.queryManager)==null||n.setCurrentQueryParams(t),(e!==this.currentHash||(r=this.queryManager)!=null&&r.hasQueryParamsChanged(t))&&(this.currentHash=e,this.loadRoute(e))}async loadRoute(e){if(!(this.loadingManager?this.loadingManager.isTransitionInProgress():this.transitionInProgress))try{if(this.loadingManager?this.loadingManager.showLoading():this.transitionInProgress=!0,!(this.authManager?await this.authManager.checkAuthentication(e):{allowed:!0,reason:"auth_disabled"}).allowed){if(this.loadingManager&&await this.loadingManager.hideLoading(),this.authManager){this.authManager.emitAuthEvent("auth_required",{originalRoute:e,loginRoute:this.config.loginRoute});let r=e!==this.config.loginRoute?`${this.config.loginRoute}?redirect=${encodeURIComponent(e)}`:this.config.loginRoute;this.navigateTo(r)}return}if(!document.getElementById("app"))throw new Error("App element not found");let n=await this.routeLoader.createVueComponent(e);await this.renderComponentWithTransition(n,e),this.loadingManager&&await this.loadingManager.hideLoading()}catch(a){console.error("\uB77C\uC6B0\uD2B8 \uB85C\uB529 \uC624\uB958:",a),this.loadingManager&&await this.loadingManager.hideLoading(),this.errorHandler?await this.errorHandler.handleRouteError(e,a):console.error("ErrorHandler not available, showing basic error:",a.message)}finally{this.loadingManager?this.loadingManager.setTransitionInProgress(!1):this.transitionInProgress=!1}}async renderComponentWithTransition(e,t){var i;let a=document.getElementById("app");if(!a)return;let o=document.createElement("div");o.className="page-container page-entered",o.id=`page-${t}-${Date.now()}`,a.querySelectorAll(".page-container").forEach(h=>{h.classList.remove("page-entered"),h.classList.add("page-exiting")}),a.appendChild(o),this.config.environment==="development"&&e._style&&this.applyStyle(e._style,t);let{createApp:r}=Vue,s=r(e);s.config.globalProperties.$router={navigateTo:(h,c)=>this.navigateTo(h,c),getCurrentRoute:()=>this.getCurrentRoute(),getQueryParams:()=>{var h;return((h=this.queryManager)==null?void 0:h.getQueryParams())||{}},getQueryParam:h=>{var c;return(c=this.queryManager)==null?void 0:c.getQueryParam(h)},setQueryParams:(h,c)=>{var l;return(l=this.queryManager)==null?void 0:l.setQueryParams(h,c)},removeQueryParams:h=>{var c;return(c=this.queryManager)==null?void 0:c.removeQueryParams(h)},currentRoute:this.currentHash,currentQuery:((i=this.queryManager)==null?void 0:i.getQueryParams())||{}},this.mobileManager&&this.mobileManager.registerGlobalProperties(s),s.mount(`#${o.id}`),setTimeout(()=>{this.cleanupPreviousPages(),this.loadingManager?this.loadingManager.setTransitionInProgress(!1):this.transitionInProgress=!1},50),this.currentVueApp&&(this.previousVueApp=this.currentVueApp),this.currentVueApp=s}cleanupPreviousPages(){let e=document.getElementById("app");if(!e)return;if(e.querySelectorAll(".page-container.page-exiting").forEach(a=>{a.parentNode&&a.remove()}),this.previousVueApp){try{this.previousVueApp.unmount()}catch(a){console.debug("Previous Vue app already unmounted:",a)}this.previousVueApp=null}if(this.loadingManager)this.loadingManager.removeLoadingElement(e);else{let a=e.querySelector(".loading");a&&a.remove()}}applyStyle(e,t){let a=document.querySelector(`style[data-route="${t}"]`);if(a&&a.remove(),e){let o=document.createElement("style");o.textContent=e,o.setAttribute("data-route",t),document.head.appendChild(o)}}navigateTo(e,t=null){typeof e=="object"&&(t=e.params||null,e=e.route),e!==this.currentHash&&this.queryManager&&this.queryManager.clearQueryParams(),this.updateURL(e,t)}getCurrentRoute(){return this.currentHash}updateURL(e,t=null){var n,r;let a=t||((n=this.queryManager)==null?void 0:n.getQueryParams())||{},o=((r=this.queryManager)==null?void 0:r.buildQueryString(a))||"";if(this.config.mode==="hash"){let s;e==="home"?s=o?`#/?${o}`:"#/":s=o?`#/${e}?${o}`:`#/${e}`,window.location.hash!==s&&(window.location.hash=s)}else{let s;e==="home"?s=o?`/?${o}`:"/":s=o?`/${e}?${o}`:`/${e}`,window.location.pathname===(e==="home"?"/":`/${e}`)?window.history.replaceState({},"",s):window.history.pushState({},"",s),this.handleRouteChange()}}};export{L as ViewLogicRouter};
